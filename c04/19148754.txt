Computational Modeling and Real-Time Control of Patient-Specific Laser Treatment of Cancer An adaptive feedback control system is presented which employs a computational model of bioheat transfer in living tissue to guide, in real-time, laser treatments of prostate cancer monitored by magnetic resonance thermal imaging (MRTI). The system is built on what can be referred to as cyberinfrastructure - a complex structure of high-speed network, large-scale parallel computing devices, laser optics, imaging, visualizations, inverse-analysis algorithms, mesh generation, and control systems that guide laser therapy to optimally control the ablation of cancerous tissue. The computational system has been successfully tested on in-vivo , canine prostate. Over the course of an 18 minute laser induced thermal therapy (LITT) performed at M.D. Anderson Cancer Center (MDACC) in Houston, Texas, the computational models were calibrated to intra-operative real time thermal imaging treatment data and the calibrated models controlled the bioheat transfer to within 5°C of the predetermined treatment plan. The computational arena is in Austin, Texas and managed at the Institute for Computational Engineering and Sciences (ICES). The system is designed to control the bioheat transfer remotely while simultaneously providing real-time remote visualization of the on-going treatment. Post operative histology of the canine prostate reveal that the damage region was within the targeted 1.2cm diameter treatment objective.  1 Introduction The use of modern methods of computer modeling and simulation to guide and predict the outcome of medical procedures is a development of monumental importance that could eventually change and enrich all of medical science and significantly enhance the health and quality of life of the human species. One recent development in computational science that can greatly increase the fidelity and predictive power of computer simulations is the use of feedback control systems that integrate computer models with field measurement systems so as to allow near-real-time calibration of the models. Such systems are collectively called Dynamic Data Driven Application Systems (DDDAS) [ 1 ], and, in theory, such systems can be used to deliver predictive simulations of unprecedented accuracy and reliability. This paper describes a canonical feedback control system developed to control and predict the outcome of laser therapies for prostate cancer. The system involves the integration of a long list of technologies and new methodologies, including Magnetic Resonance Thermal Imaging (MRTI), computer visualization, laser optics, high-speed networks, nonlinear dynamic bioheat transfer models of heterogeneous tissue, adaptive meshing, high-performance parallel computing, cell-damage and heat-shock protein models, inverse analysis, calibration, model validation, signal processing, optimal control algorithms, and error estimation and control. In our particular DDDAS, the fact that these diverse technologies and systems are connected across a high-speed computational grid connecting remote sites - an imaging and medical unit in Houston and a modeling and computational unit in Austin - qualifies, in our opinion, as an example of cyberinfrastructure [ 2 ]. The basic hypothesis underlying the creation of this system is that cancer cells can be eradicated when subjected to sufficient heat for a sufficient period of time. Such heat sources can be supplied by inserting optical fibers into the infected tissue and then supplying energy by means of a laser. If one can predict the evolution of temperature fields generated by such heat sources, then the location of the fiber and the frequency and power of the laser can be controlled to minimize damage to healthy tissue while maximizing damage to tumor cells. The development of calibrated models that accurately simulate bioheat transfer in prostate tissue is thus a key component of the system. But, as can be anticipated, there are many complicating factors in developing such a control system, including, for example, the development of computational models of cell damage and heat-shock protein expression. This research aims to focus on minimally invasive thermal therapy delivery designed to provide local treatment of focal disease, such as those designed to replace, or act as an adjuvant to, conventional surgery. The real-time monitoring of temperature using MRTI is useful in these treatments in order to increase both efficacy and safety due to the rapid heating and high temperatures involved. The proposed technology further increases this efficacy by helping to optimize the conformality of the treatment as well as minimize risks associated with damaging nearby critical structures. The core simulation tool embeds experimental real-time thermal imaging data within the nonlinear Pennes bioheat transfer model. The thermal imaging data is provided by an MRTI device that follows the actual therapy at the imaging laboratory at M.D. Anderson Cancer Center (MDACC) in Houston, Texas. The MRTI technology developed over the past decade is a modification of existing MRI technology to use fast imaging sequences to acquire larger imaging volumes in the same time with comparable temperature sensitivity and to provide a 3D temperature field as a function of position and time in the living tissue. The optimal control system is guided by simulations performed at the computational modeling arena with the Institute for Computational Engineering and Sciences (ICES) in Austin, Texas with high-bandwidth network connections to computers at the Texas Advanced Computing Center (TACC). As noted, through accurate computer prediction, the location and power of the laser can, in principle, be modulated to maximize damage to the tumor while minimizing damage to healthy tissue. Computer prediction may be used to accurately control the affected tissue response through a collection of imaging based measurements about how the complex physiological system is responding to the surgery and to make changes in the treatment plan based on an intelligent understanding of the physiological pathways and feedback mechanisms to affect the surgical outcome. This represents a significant extension of modern simulation methods as a means for real-time calibration and validation of models are made possible in this system. The possibility of simulating bioheat transfer in cancerous tissues of mice was established in the work of Rylander et al. [ 3 , 4 ] that was a precursor of the present study. In these works, primitive models of cell damage and heat-shock-protein expression were also proposed and calibrated by means of in-vitro experiments. Following this introduction, we describe the computational infrastructure constructed to implement the control strategy, including the assembly of various software modules and the new software units developed to carry out various functions for the systems. In section 3, we describe inverse analysis and optimization algorithms developed around a computational model based on a nonlinear parabolic partial differential equation that is a generalization of the classical Pennes model [ 5 ]. The control paradigm is based on the derivation of backward-in-time adjoint problems associated with various cost functionals. It is shown that a single mathematical and computational framework can be developed for adjoints corresponding to control cell damage, HSP expression, and numerical accuracy in approximations of specific quantities of interest. The computational model of heat transfer is constructed using adaptive hpfinite elements[ 6 ] and a Crank-Nicolson scheme for approximating the temporal behavior of the temperature field. Section 4 contains discussions of results of actual physical trials employing the full system for predicting thermal response and controlling laser input. This involves so-called phantom tests, run on an agar gel in which a canine prostate is implanted, and MRTI-monitored invivo experiments, guided by the control system, involving laser treatment on prostates of living canines. The results clearly establish that the system can provide accurate depictions of in-vivo thermal histories in canines and that the computer simulations provide adequate information for effectively controlling laser inputs and locations. Major conclusions of the study are collected in section 5.  2 CyberInfrastructure and Work Flow We begin by describing the so-called cyberinfrastructure developed to implement a Dynamic Data Driven Application System (DDDAS). This involves developing a computational grid which connects the experimental arena, at which the laser treatment for prostate cancer is done, and the computational arena, at which the computer modeling, visualizations, and high performance computing is carried out. The former is built around the MRTI laboratory at M. D. Anderson Cancer Center in Houston, Texas and the latter is managed at ICES in Austin, Texas, approximately 150 miles away. Communications between these arenas is handled via batch sftp over a commercial GigE Internet connection. The full system is depicted symbolically in Figure 1 . The principal software modules and the data flow are depicted in Figure 2 . The control strategy involves multiple steps. Several days prior to the laser treatment, the prostate area of the therapy subject, in our case a laboratory canine, is scanned using a 1.5T clinical MR scanner (Excite HD, GEHT, Waukesha, WI). This pre-operative, patient-specific data is transmitted to the computational arena where an initial 3D finite element mesh approximating the prostate geometry is generated. Several mesh generation packages are available, including the Level Set Boundary-Interior-Exterior (LBIE) Mesher 1 presented in [ 7 ]. A pipeline, Figure 3 , of commercial software may also be used. AMIRA, www.amiravis.com , is used to perform a semi-automatic segmentation and create a faceted surface representation of the prostate. CUBIT, cubit.sandia.gov, is then used to create a pillowed hexahedral mesh and apply boundary conditions. The majority of the time in this pipeline is spent in the semi-automatic segmentation of the prostate. An expert user must identify and extract the geometry of the prostate from the pre-operative images. Prior to treatment, reservations for access to the supercomputers as well as the MRI scanner are made, and initial optimal laser parameters are identified such as the location of the endpoint of the optical fiber, laser power as a function of time, etc. A trial simulation of the therapy is performed using initial bioheat transfer data, some taken from handbooks [ 8 ], to determine the initial location of the laser fiber. The initial parameters are ultimately corrected during the calibration phase of the process using temperature data generated via MRTI. This is described fully in section 4. The entire system, computation, data transfer, visualization, etc., is tested repeatedly to ensure stable code execution during the treatment window. The laser treatment may take place over a period of up to 18 minutes, but shorter procedures may also be adequate. We employ an FDA cleared system for MR temperature monitoring of laser induced thermal therapy (Visualase®, BioTex Inc., Houston, TX) modified to be controlled from remote supercomputers in Austin. The Visualase uses a diffusing interstitial laser fiber to provide the heat source to heat the tissue to an ablative temperature regime. This system is monitored remotely at the computational arena in Austin. Upon initiation of the treatment process, the software processes the intra-operative MRI data to register the computational domain and real-time MRTI data drives the calibrations aligning the parameters of the Pennes bioheat transfer model to the patient's biological tissue values. As new thermal imaging data is acquired intermittently, the computational prediction is compared to the measurements of the real-time thermal images and the differences seen are used to update the computations of the optimal laser parameters needed to achieve the original planned treatment. If the model is incorrectly calibrated and the thermal images begin to detect unexpected high temperatures, the laser power is turned off. The model must then be recalibrated before proceeding. The entire system is built around five main computing modules as indicated in Figure 2 . The treatment protocol is broken into four stages, as illustrated in Figure 4 . The problems of real-time calibration, optimal control, and goal-oriented error estimation are solved in parallel by separate groups of processors working together as indicated in Figure 5 . Before any thermal image transfer occurs, an initial prediction of the entire time history of temperature/damage/HSP from textbook or pre-calibrated material properties is computed. The time window of the prediction is the entire length of the treatment [0, t f ]. During the first stage, the biological domain is pulse heated during time [0, t 0] and MRTI thermal image data is acquired from time [0, t 1 > t 0] for the heating as well as the cooling. The images from [0, t 1] are used to calibrate the bioheat transfer model. The time window [ t 1, t 2] is allotted to finish the calibration computation. The calibration computations are check-pointed intermittently. The timing of the optimal control computations are implicitly based on the acquisition of the thermal image at time t 2. At time t 2, a second group of processors uses the most recent checkpoint of the calibration parameter update and proceeds to optimize the power from [ t 3, t f ]( t 3 > t 2); The time window [ t 2, t 3] is provided to finish the optimal control computations. At time t 3, the optimizer is stopped and the final prediction is made over the time window [ t 3, t f ]. During this fourth and final stage, the optimal laser control parameters modulate the laser power for the remainder of the treatment. In the event of the detection of an unexpectedly high temperature within the biological domain, a fail-safe shutoffs the laser power. A Control Task unit orchestrates the treatment while simultaneously acting as a data server of the thermal images. Periodically during treatment, the group-wise optimization solutions and error estimates are collected on the Control Task data repository. A skeleton of the entire FEM mesh of the biological domain is stored on the Control Task. Using the collective error estimates, a mesh refinement strategy is computed on the Control Task and both the collective optimization solutions and refinement strategy are broadcast to the individual Computational Groups. The Control Task/Data Server, Figure 5 , reads in the thermal images from disk, filters the thermal images to remove noise, broadcasts the thermal images to each computational group as needed, and transmits the laser power to Houston. The timing of the laser power control is implicit through the image acquisition by the HP3d, Figure 5 , in Austin. As new thermal images are written to disk physically in Houston, they are transferred to disk at the computing center (TACC) in Austin. When the Data Server detects that the full set of thermal images for a time instance is available, the predicted power to be used for the next time interval is sent to Houston. A high-level abstraction of the HP3d 2 [ 9 ] hp-adaptive finite element solver is given in Figure 5 . The models are implemented efficiently in parallel to meet the demands of rapid calibration and rapid optimal control calculations. The finite element solver is implemented at the Austin site and run at the computing center (TACC) through a network connecting ICES to the center. The software infrastructure is built from the PETSc [ 10 ] parallel computing paradigm and the TAO [ 11 ] parallel optimization library. AVS [ 12 ] is used in conjunction with a VNC server for remote visualization. AVS coroutines are used to manage and coordinate the simultaneous visualization of the MRI anatomical image, MRTI thermal image, and finite element data sets. From a computational point of view, the orchestration of a successful laser treatment must handle the problems of registration, calibration, and optimal control invisibly to the surgeon, and provide a priori visualization of the outcome of the treatment for use as guidance for the actual treatment.  3 Real-Time Optimization We employ a nonlinear generalization of the classical Pennes [ 5 ] model of bioheat transfer as the base model for simulating the evaluation of temperature in the biological domain due to energy supplied by the laser. The domain, ? , shown in Figure 6 , is heated by a laser heat source within the time interval [0, ? ]. The entire time span of the laser treatment occurs within the interval [0, T ], [ 0 , ? ] ? [ 0 , T ] . The Pennes model describes bioheat transfer as the conservation of energy applied to a motionless non-deforming mass of human tissue. The muscle, fat, blood, connective tissue is represented as a single continuous medium that may have spatially varying properties and mass flux does not occur across the boundary. The heat transfer between blood and tissue is the defining characteristic of biological heat transfer; as blood per-fuses the complex vasculature networks embedded in tissue, it may act as a significant spatially varying heat source or sink. The biological domain ? is composed of a of region of healthy tissue ? H and a region of cancerous tissue ? C , ? = ? H ? ? C . The nonlinear Pennes bioheat transfer model is given as follows: ? c p ? u ? t ? ? ? ( k ( u , x , ? ) ? n ) + ? ( u , x , ? ) c b l o o d ( u ? u a ) = Q l a s e r ( ? , x , t ) in ? Q l a s e r ( ? , x , t ) = 3 P ( t ) ? a ? t r exp ( ? ? e f f ? x ? x 0 ? ) 4 ? ? x ? x 0 ? ? t r = ? a + ? s ( 1 ? g ) ? e f f = 3 ? a ? t r ? k ( u , x , ? ) ? u ? n = h ( u ? u ? ) on ? ? C ? k ( u , x , ? ) ? u ? n = G on ? ? N u ( x , 0 ) = 0 in ? The initial conditions, u 0, are taken as the baseline body temperature. The continuum is denoted ? and the specific heat of blood is denoted c b l o o d [ J k g ? K ] . On the Cauchy boundary, ?? C , h is the coefficient of cooling and u ? is the ambient temperature. The prescribed heat flux on the Neumann boundary, ?? N , is denoted G . The optical-thermal response to the laser source, Qlaser ( ? , x , t ), is modeled as the classical spherically symmetric isotropic solution to the transport equation of light within a laser-irradiated tissue [ 13 ]. ? denotes an array of bioheat transfer model parameters. ? ? ( k 0 ( x ) , k 1 , k ~ 3 , k ^ 3 , ? 0 ( x ) , ? 1 , ? ~ 3 , ? ^ 3 , P ( t ) , ? a , ? s , x 0 ) P ( t ) is the laser power as a function of time, ? a and ? s are laser coefficients related to laser wavelength and give probability of absorption and scattering of photons, respectively. The anisotropic factor is denoted g and x 0 denotes the position of laser photon source. The scalar-valued coefficient of thermal conductivity, k [ J s ? m ? K ] , is a function of the local temperature, u , and is assumed to be of the form ( Figure 7 ) k ( u , x ) = k 0 ( x ) + k 1 atan ( k ~ 2 ( u ? k ^ 3 ) ) where k 0 ( x ) [ J s ? m ? K ] , k 1 [ J s ? m ? K ] , k ~ 2 [ 1 K ] , k ^ 3 [ K ] ? R . The function k 0( x ) is allowed to vary over the spatial dimension to capture the biological tissue heterogeneity. The media is thus assumed to be thermally isotropic (referring to heat flux) but spatially heterogeneous. The perfusion coefficient is given by ? [ k g s m 3 ] . Empirical evidence suggests that ? [ k g s m 3 ] , is a smooth, monotone increasing bounded function of temperature, Figure 7 . We use the characterization, ? ( u , x ) = ? 0 ( x ) + ? 1 atan ( ? ~ 2 ( u ? ? ^ 3 ) ) where ? 0 [ k g s m 3 ] , ? 1 [ k g s m 3 ] , ? ~ 2 [ 1 K ] , ? ^ 3 [ K ] ? R . Note that ? 0( x ) is allowed to vary over the spatial dimension as the blood perfusion within the necrotic core of a cancerous tumor or the blood perfusion within a damaged tissue is expected to be signifficantly lower than the surrounding healthy tissue. The main problems of interest is the real-time solution of the calibration of the model coefficients and the optimal control of the laser. The problem of adaptive mesh refinement is presented in [ 14 ]. The model parameter available for control of the laser heat source is the power as a piece-wise constant function of time, P ( t ). The material properties available for model calibration are the thermal conductivity parameters k 0( x ), k 1, k? 3, k? 3 the perfusion parameters ? 0 ( x ) , ? 1 , ? ~ 3 , ? ^ 3 and the coefficients of scattering and absorption, ? s and ? a . The position of the laser tip, x 0 = ( x 0, y 0, z 0), may be used in both calibration and optimal control. Notice the explicit dependence of thermal conductivity, k ( u , x , ? ), perfusion, ? ( u , x , ? ), and laser source, Qlaser ( ? , x , t ), on ? . The temperature field resulting from the application of the heat source is an implicit function of the model parameters. u ( ? , x , t ) t ? [ 0 , T ] x ? ? ? ? P where P is defined in (5) . 3.1 Calibration of Pennes Model Given a fixed laser power, P ( t ), the problem of model calibration is to find the set thermal conductivity parameters, k 0( x ), k 1, k? 3, k? 3, blood perfusion parameters, ? 0 ( x ) , ? 1 , ? ~ 3 , ? ^ 3 , optical coefficients, ? a , ? s , and laser parameters, x 0, that minimize the L 2(0, T ; L 2( ? )) norm of the difference between the predicted temperature field and an ideal temperature field, u ideal ( x , t ). (1) Q ( u ( ? , x , t ) , ? ) = 1 2 ? u ( ? , x , t ) ? u ideal ( x , t ) ? L 2 ( [ 0 , T ] ; L 2 ( ? ) ) 2 = 1 2 ? ? ? 0 T ( u ( ? , x , t ) ? u ideal ( x , t ) ) 2 d t d x dx = dx 1 dx 2 dx 3 being a volume element. We describe here a calibrated deterministic model; stochasticity is to be addressed in future work. The ideal field for the calibration problem is the experimentally determined temperature field, u exp ( x , t ), obtained from in-vivo MRTI data. The thermal imaging data, as well at the anatomical data, is acquired using a 1.5 T MRI scanner (Sigma Excite HD, Milwaukee, WI), Figure 8 , using a 2D temperature sensitive echo planar imaging sequence; the scanner is located at the experimental (MRTI) arena in Houston. The MRTI process itself involves a phase subtraction technique. Each consecutive phase image is subtracted from a baseline image that was acquired prior to heating [ 15 ]. These phase difference images are proportional to temperature difference, ?u . To convert phase to temperature other factors including echo time, magnetic field strength, gyro magnetic ratio water ppm shift with temperature are required. The total temperature change is given as the cumulative sum of the individual temperature differences. The image acquisition time of the MRTI data is 4-6 seconds. Given a file size of approximately .32MB for one time instance of thermal imaging data and and average bandwidth transferring data from Houston to Austin of approximately .2MB/s, the time to transfer the thermal imaging data is roughly one second. 3.2 Optimal Control of the Treatment The optimal treatment of a focal disease is defined by the following criteria: – Maintain the functionality of the healthy region of the tissue. – Maximize damage to the cancerous region. Various metrics based on temperature, damage, or HSP expression are used to evaluate the degree to which the criteria is satisfied. For optimal control, the laser power, P ( t ), is varied as a function of time to minimize the objective function and the material parameters, k ( u , x , ? ), ? ( u , x , ? ), ? s , and ? a are fixed. An optimal laser position x 0 may be pre-computed. However, the surgeon's ability to achieve the pre-computed position is limited and the actual treatment position of the laser may need to be calibrated from the thermal imaging data. Temperature-Based Optimal Control is similar to the calibration problem, the goal being to find the set of model parameters that minimize the space-time norm of the difference between the computed temperature field u ( ? , x , t ) and an ideal field u ideal ( x , t ). The mathematical structure is the same as in (1) . However, the ideal field for temperature-based optimal control maximizes damage to cancerous tissue while minimizing damage to healthy tissue, u i d e a l = { 37.0 ° C x ? ? H 60.0 ° C x ? ? C } Damage Based Control attempts to minimize the L 2-norm of the difference between an ideal damage field and the computed damage field, Q ( u ( ? , x , t ) , ? ) = 1 2 ? ? ( u ( ? , x , t ) ) ? D i d e a l ( x ) ? L 2 ( ? ) 2 = 1 2 ? D ( x ) ? D i d e a l ( x ) ? L 2 ( ? ) 2 An ideal damage field, D ideal ( x ), maximizes damage to the cancerous region while maintaining functionality of the healthy region. Within the cancerous region there is a threshold damage value, denoted D C i d e a l , above which all cancerous cells will die. Similarly, within the healthy region there is a threshold damage value, denoted D H i d e a l , below which the functionality is maintained for all healthy cells. D i d e a l ( x ) ? { D C i d e a l x ? ? C D H i d e a l x ? ? H } The functional that acts on the temperature field and returns the corresponding damage field is denoted ? , ? : L 2 ( 0 , T , H 1 ( ? ) ) ? L 2 ( ? ) ? ( u ( ? , x , t ) ) = D ( x ) ? x ? ? The damage field, D ( x ), reflects the time-temperature thermal injury resulting from the application of the heat source. An Arrhenius model and a Two-State model [ 16 ] are used to quantify the damage from the thermal assault on the biological domain, ? . The Arrhenius model is a classical empirical law used in early models of thermal effects and properties of molecular averages. For the Arrhenius model, ' represents the damage index , and for the Two-State model, ? represents the cell viability . (2) ? ( u ( ? , x , t ) ) = D ( x ) = { ? 0 T A e ? E a R u d t Arrhenius ? 0 T e ? ( h u + ? t + ? ) 1 + e ? ( h u + ? t + ? ) d t Two-State } The constants E a , A , and R are known constants of the Arrhenius model and h , ? , and ? are known constants of the Two-State model determined from invitro experiments on cell samples [ 16 ]. Note that the numerical values of D C i d e a l and D H i d e a l for the Arrhenius model will be different from D C i d e a l and D H i d e a l for the Two-State model. Heat Shock Protein (HSP) Based Control is similar to damage control. It is assumed that the functional mapping the temperature field to the corresponding HSP expression field is known: H : L 2 0 , T , H 1 ? ) ) ? L 2 ( ? ) H ( u ( ? , x , t ) ) ( x ) ? L 2 ( ? ) The constitutive data mapping the temperature field to the HSP expression field is obtained from in vitro cellular data [ 17 ]. An ideal HSP expression field, H ideal ( x ), maximizes the protective effect of heat shock proteins within healthy tissue while minimizing heat shock protein expression within the cancerous region. A summary of the objective functions is provided as follows: (3) Q ( u ( ? , x , t ) , ? ) = { 1 2 ? ? ? 0 T ( u ( x , t ) ? u i d e a l ( x ) ) 2 d t d x calibration ? temp. based 1 2 ? ? ( ? 0 ? A e ? E a R u d t ? D i d e a l ( x ) ) 2 d x Arrhenius 1 2 ? ? ( ? 0 ? e ? ( h u + ? t + ? ) 1 + e ? ( h u + ? t + ? ) d t ? D i d e a l ( x ) ) 2 d x Two-State 1 2 ? ? ( H ( x ) ? H i d e a l ( x ) ) 2 d x HSP } 3.3 PDE Constrained Optimization The mathematical structure of the calibration and optimal control problems is the same: Find the set of model parameters ? *, that minimizes a given objective function, Q , over a parameter manifold, P , Find ? ? ? P s . t . Q ( u ( ? ? ) , ? ? ) = inf ? ? P Q ( u ( ? ) , ? ) subject to the constraints of a variational form of the Pennes PDE, C ( u , ? ; v ) : V × P × V ? R (4) ? v C ( u , ? ; v ) = 0 = ? 0 T ? ? ? c p ? u ? t v d x d t + ? 0 T ? ? k ( u , x , ? ) ? u ? ? v d x d t + ? 0 T ? ? ? ( u , x , ? ) c b l o o d ( u ? u a ) v d x d t + ? 0 T ? ? ? N G v d A d t ? ? 0 T ? ? Q l a s e r ( ? , x , t ) v d x d t + ? 0 T ? ? ? C h ( u ? u ? ) v d x d t The variational form (4) is nonlinear with respect to the first two arguments, u , ? , but linear with respect to the test function, v . The proper mathematical setting for the trial and test functions is the space of mappings from the time domain to the appropriate function space, H 1( ? ), u ( ? , x , t ) ? ( u ( ? , t ) ) ( x ) : ( 0 , T ) ? H 1 ( ? ) such that the H 1 norm of the mapping, u , is L 2 integrable in time, ? 0 T ? u ( ? , ? , t ) ? H 1 2 d t < ? The appropriate space containing such mappings is V ? L 2 ( 0 , T ; H 1 ( ? ) ) . A well-defined solution to the variational problem (4) may be shown to exist for model parameters, ? , belonging to a parameter space, P , (5) P = { ? ? L ? ( ? ) × R 3 × L ? ( ? ) × R 3 × L ? ( [ 0 , T ] ) × R 5 : 0 < k ? < k 0 ( x ) + k 1 atan ( k 2 ( u ? k 3 ) ) < k ? < ? 0 < ? ? < ? 0 ( x ) + ? 1 atan ( ? 2 ( u ? ? 3 ) ) < ? ? < ? } over which the operators are coercive, bounded, and type- M [ 18 ] . The gradient of the objective function with respect to the control variables is the work horse of our optimization schemes. The objective function is guaranteed to decrease in the direction of the gradient and is also used to approximate the Hessian in a quasi-Newton scheme. A Newton scheme for optimization is not considered in this work. The real-time nature of the control system does not permit the efficient computation of the Hessian of the objective function. An adjoint solution method of the optimization problems is used to compute the gradient. The adjoint method considered employs framework of differential calculus in Banach spaces and clearly demonstrates how the use of an adjoint variable eliminates the need to solve for sensitivities of the solution. An analytical expression for gradient of the objective function with respect to the control variables is determined under the assumption that the objective function and temperature field are Fréchet-differentiable 3 . Considering the Pennes model solution, u , as a function of the the control parameters, ? , and the objective function, Q , as a function of the Pennes model solution, u , and the control parameters, ? , the composition of the objective function with the Pennes model solution, denoted as Q ? u , may be considered as a Fréchet-differentiable mapping solely from parameter space to R . u ( ? ) : P ? V Q ( u , ? ) : V × P ? R Q ? u ? Q ( u ( ? ) , ? ) : P ? R The derivative of the composition, Q ? u , is of interest and is computed under the following first order approximations of the solution and objective function. u ( ? + ? ^ ) = u ( ? ) + u ? ( ? ) ? ^ Q ( u + u ^ , ? + ? ^ ) = Q ( u , ? ) + D u Q ( u , ? ) u ^ + D ? Q ( u , ? ) ? ^ Here u ? : P ? V denotes the Fréchet derivative of the solution with respect to the control variables, D u Q : V ? R is the partial Fréchet derivative with respect to the solution, and D ? Q : P ? R is the partial Fréchet derivative with respect to the control variables. For functions defined on the Cartesian products of spaces, the notion of partial Fréchet differentiability is understood as follows: Partial Fréchet-differentiability: Let X denote the direct sum of the space of trial functions and parameter space, X = V ? P . For U open, U ? X , and F : U ? Y consider the point x = ( u , ? ) ? X . Define f u ( z ) : V ? R f u ( z ) = F ( z , ? ) f ? ( s ) : P ? R f ? ( s ) = F ( u , s ) The Fréchet derivative of f u ( z ) at z = u and f ? ( s ) at s = ? are the partial derivatives F in the direction of u and ? ; respectively. D u F ( x ) : V ? R D u F ( x ) = D f u ( u ) D ? F ( x ) : P ? R D ? F ( x ) = D f ? ( ? ) The Fréchet derivative of F at ( u , ? ) is the sum ofits partial derivatives [ 19 ]. The chain rule holds for a composition of Fréchet differentiable functions [ 19 ]; the derivative of the composition is computed as follows, (6) D ( Q ? u ) : P ? R D ( Q ? u ) = D u Q ( u , ? ) u ? ( ? ) + D ? Q ( u , ? ) Notice that to compute the gradient of the objective function, Q , the sensitivities, u ?, must be computed. The variation of the PDE constraints with respect to the model parameters may be used to compute the sensitivities. Only model parameters for which a solution to the governing PDE exists are of interest (i.e. ? : C ( u ( ? ), ? ; v ) = 0 ? v ). Within this hyper-space the variation is identically zero. (7) ( D u C u ? + D ? C ) : P ? R D u C ( u , ? ; v ) u ? ( ? ) + D ? C ( u , ? ; v ) = 0 ? v ? V where D u C : V ? R is the partial Fréchet derivative of the PDE with respect to the solution and D ? C : P ? R is the partial Fréchet derivative of the PDE with respect to the model parameters. The adjoint method of computing the gradient of the objective function may now be formulated. Theorem . Given ? ? P , the derivative of the objective function is (8) D ( Q ? u ) = D ? Q ( u ( ? ) , ? ) ? D ? C ( u ( ? ) , ? ; p ) where u ? V is the solution of the Pennes model and p ? V is the solution to the adjoint problem. Find p ? V : ? D u C ( u ( ? ) , ? ; p ) , u ^ ? V ? × V = ? D u Q ( u ( ? ) , ? ) , u ^ ? V ? × V ? u ^ ? V Proof. For a fixed ? , the solution to the adjoint problem, p , satisfies ? D u C ( u ( ? ) , ? ; p ) , u ? ? V ? ? V = ? D u Q ( u ( ? ) , ? ) u ? ? V ? × V From the first variation of the PDE constraints (7) , we have that D u C ( u ( ? ) , ? ; p ) u ? ( ? ) = ? D ? C ( u ( ? ) , ? ; p ) The gradient follows from a direct substitution in (6) to eliminate the sensitivities: D ( Q ? u ) = D u Q ( u , ? ) u ? ( ? ) + D ? Q ( u , ? ) = D ? Q ( u , ? ) ? D ? C ( u ( ? ) , ? ; p ) Recall that D ( Q ? u ) is an operator on the parameter space, P , and the desired solution, ? , is such that D ( Q ? u ) ( ? ) = 0 ? ? D ( Q ? u ) ( ? ) , ? ^ ? = 0 ? ? ^ ? P As a concrete example, the strong form of the adjoint problem is derived from the Fréchet derivatives used to derive (8) . The following Taylor series expansions are used in computing the derivatives of the variational form of Pennes model: k ( u + u ^ , ? + ? ^ ) = k ( u , ? ) + u ^ ? k ? u + k ^ 0 ? k ? k 0 + k ^ 1 ? k ? k 1 + k ^ 2 ? k ? k 2 + k ^ 3 ? k ? k 3 + h . o . t . ? ( u + u ^ , ? + ? ^ ) = ? ( u , ? ) + u ^ ? ? ? u + ? ^ 0 ? ? ? ? 0 + ? ^ 1 ? ? ? ? 1 + ? ^ 2 ? ? ? ? 2 + ? ^ 3 ? ? ? ? 3 + h . o . t . An alternative formulation of (4) must be used to account for the initial condition. The initial condition is accounted for in the variational form by integrating by parts on the time derivative. ? ? ? c p [ u ( x , 0 ) p ( x , 0 ) ? u ( x , T ) p ( x , T ) ] d x = ? 0 T ? ? ? c p ( ? u ? t p + ? p ? t u ) d x d t Recognizing that u 0( x ) = u ( x , 0) and not testing the equation at the final time, p ( x , T ) = 0, leads to the following C ( u , ? ; p ) = ? ? 0 T ? ? ? c p ? p ? t u d x d t + ? 0 T ? ? k ( u , ? ) ? u ? ? p d x d t + ? 0 ? ? ? c b l o o d ? ( u , ? ) ( u ? u a ) p d x d t + ? 0 T ? ? ? h u p d A d t + ? ? u 0 ( x ) p ( x , 0 ) d x Applying the definition of the partial Fréchet derivative to the variational PDE gives C ( u + u ^ , ? ; p ) = ? ? 0 T ? ? ? c p ? p ? t ( u + u ^ ) d x d t + k ( u + u ^ , ? ) ? ( u + u ^ ) ? ? p d x d t + ? 0 T ? ? c b l o o d ? ( u + u ^ , ? ) ( ( u + u ^ ) ? u a ) p d x d t + ? 0 T ? ? ? h ( u + u ^ ) p d A d t + ? ? u 0 ( x ) p ( x , 0 ) d x Substituting the Taylor series expansion for k and ? and rearranging terms gives C ( u + u ^ , ? ; p ) ? C ( u , ? ; p ) = [ ? ? 0 T ? ? ? c p ? p ? t u ^ d x d t + ? 0 T ? ? ? h u ^ p d A d t + ? 0 T ? ? ( k ( u , ? ) ? u ^ ? ? p + u ^ ? k ? u ? u ? ? p ) d x d t + ? 0 T ? ? ( ? ( u , ? ) u ^ p + u ^ ? ? ? u ( u ? u a ) p ) d x d t + ? 0 T ? ? ( u ^ k ( u , ? ) ? u ^ ? ? p + 1 2 u ^ 2 ? 2 k ? u 2 ? u ? ? p ) d x d t + … ] Notice that the terms involving the initial condition cancel out. Letting D u C ( u , ? ; p ) u ^ = ? 0 T ? ? ? c p ? u ^ ? t p d x d t + ? 0 T ? ? ? h u ^ p d A d t + ? 0 T ? ? k ( u , ? ) ? u ^ ? ? p + u ^ ? k ? u ? u ? ? p d x d t + ? 0 T ? ? ? ( u , ? ) u ^ p + u ^ ? ? ? u ( u ? u a ) p d x d t implies that (9) ? C ( u + u ^ , ? ; p ) ? C ( u , ? ; p ) ? D u C ( u , ? ; p ) u ^ ? ? C ~ ? u ^ ? 2 where the higher order terms of the thermal conductivity, ? 2 k ? u 2 , and perfusion, ? 2 ? ? u 2 , are assumed bounded and hidden in the constant, C? . For a particular test/adjoint function, p , the constant, C? , also depends on the norm of the test/adjoint function, ? p ?; however, because p ? V , the norm is always bounded and (9) holds. It follows from the definition that D uC ( u , ? ; p ) is the Fréchet derivative of C . The strong form of the adjoint formulation is as follows. ? ? c p ? p ? t ? ? ? ( k ( u , x , ? ) ? p ) + ? k ? u ( u , x , ? ) ? u ? ? p + ? ( u , x , ? ) p + ? ? ? u ( u , x , ? ) p ( u ? u a ) = ? Q in ? ? k ( u , x , ? ) ? p ? n = h p on ? ? p ( x , T ) = 0 in ? Notice that the adjoint problem for the calibration, optimal control, and goal oriented error estimates are all essentially the same, the only difference being the source term ?Q which depends on the quantity of interest. 3.4 Discretization of Equations The Galerkin representations of the temperature field and adjoint variable are assumed as follows u ( x , t ) = ? k = 1 N s t e p ? j = 1 N d o f ? j k ( t ) ? j ( x ) p ( x , t ) = ? k = 1 N s t e p ? i = 1 N d o f ? i k ( t ) ? i ( x ) where N step is the number of time steps, N dof is the number of Galerkin coefficients, and ? i 's are the finite element shape functions. ? j k ( t ) = { t k ? t t k ? t k ? 1 ? j k ? 1 + t ? t k ? 1 t k ? t k ? 1 ? j k , t ? [ t k ? 1 , t k ) 0 , otherwise } ? i k ( t ) = { ? i k , t ? [ t k ? 1 , t k ) 0 , otherwise } The time discretization of the power is assumed piecewise constant in time: P ( t ) = { P k , t ? [ t k ? 1 , t k ) 0 , otherwise } The spatial variation of the parameters fields is assumed to have the following Galerkin representation, k 0 ( x ) = ? j k 0 j ? j ( x ) ? 0 ( x ) = ? j ? 0 j ? j ( x ) where ? ( x ) are piecewise constant across elements. The test function are assumed piecewise constant in time v ( x , t ) = ? k = 1 N s t e p ? i = 1 N d o f v i k ( t ) ? i ( x ) v i k ( t ) = { v i k , t ? [ t k ? 1 , t k ) 0 , otherwise } The governing equations (4) are solved using a Crank-Nicolson time stepping scheme. The Adjoint Gradient of the quantity of interest is constructed from the derivative of the discretized equations with respect to an arbitrary single model variable, ? i . The gradient of the quantity of interest is computed using the chain rule for derivatives taken with respect to the numerically computed quantity of interest. The initial condition does not depend on the model parameters, ? u 0 ? ? i = 0 . ? ? ? i Q ( u ( ? , x , t ) , ? ) = ? k = 1 N s t e p ? Q ? u k ? u k ? ? i As shown in [ 7 ], the numerical derivative of the quantity of interest with respect to a model variable may be computed as follows. ? Q ( u , ? ) ? ? i = ? k = 1 N s t e p ( ? ? t k ? ? ? k ? ? i ( u k ? 1 2 , x , ? ) ? u k ? 1 2 ? ? p k d x ? ? t k ? ? c b l o o d ? ? ? ? i ( u k ? 1 2 , x , ? ) ( u k ? 1 2 ? u a ) p k d x + ? t k ? ? ? Q l a s e r ? ? i ( ? , x , t k ) p k d x )  3.1 Calibration of Pennes Model Given a fixed laser power, P ( t ), the problem of model calibration is to find the set thermal conductivity parameters, k 0( x ), k 1, k? 3, k? 3, blood perfusion parameters, ? 0 ( x ) , ? 1 , ? ~ 3 , ? ^ 3 , optical coefficients, ? a , ? s , and laser parameters, x 0, that minimize the L 2(0, T ; L 2( ? )) norm of the difference between the predicted temperature field and an ideal temperature field, u ideal ( x , t ). (1) Q ( u ( ? , x , t ) , ? ) = 1 2 ? u ( ? , x , t ) ? u ideal ( x , t ) ? L 2 ( [ 0 , T ] ; L 2 ( ? ) ) 2 = 1 2 ? ? ? 0 T ( u ( ? , x , t ) ? u ideal ( x , t ) ) 2 d t d x dx = dx 1 dx 2 dx 3 being a volume element. We describe here a calibrated deterministic model; stochasticity is to be addressed in future work. The ideal field for the calibration problem is the experimentally determined temperature field, u exp ( x , t ), obtained from in-vivo MRTI data. The thermal imaging data, as well at the anatomical data, is acquired using a 1.5 T MRI scanner (Sigma Excite HD, Milwaukee, WI), Figure 8 , using a 2D temperature sensitive echo planar imaging sequence; the scanner is located at the experimental (MRTI) arena in Houston. The MRTI process itself involves a phase subtraction technique. Each consecutive phase image is subtracted from a baseline image that was acquired prior to heating [ 15 ]. These phase difference images are proportional to temperature difference, ?u . To convert phase to temperature other factors including echo time, magnetic field strength, gyro magnetic ratio water ppm shift with temperature are required. The total temperature change is given as the cumulative sum of the individual temperature differences. The image acquisition time of the MRTI data is 4-6 seconds. Given a file size of approximately .32MB for one time instance of thermal imaging data and and average bandwidth transferring data from Houston to Austin of approximately .2MB/s, the time to transfer the thermal imaging data is roughly one second.  3.2 Optimal Control of the Treatment The optimal treatment of a focal disease is defined by the following criteria: – Maintain the functionality of the healthy region of the tissue. – Maximize damage to the cancerous region. Various metrics based on temperature, damage, or HSP expression are used to evaluate the degree to which the criteria is satisfied. For optimal control, the laser power, P ( t ), is varied as a function of time to minimize the objective function and the material parameters, k ( u , x , ? ), ? ( u , x , ? ), ? s , and ? a are fixed. An optimal laser position x 0 may be pre-computed. However, the surgeon's ability to achieve the pre-computed position is limited and the actual treatment position of the laser may need to be calibrated from the thermal imaging data. Temperature-Based Optimal Control is similar to the calibration problem, the goal being to find the set of model parameters that minimize the space-time norm of the difference between the computed temperature field u ( ? , x , t ) and an ideal field u ideal ( x , t ). The mathematical structure is the same as in (1) . However, the ideal field for temperature-based optimal control maximizes damage to cancerous tissue while minimizing damage to healthy tissue, u i d e a l = { 37.0 ° C x ? ? H 60.0 ° C x ? ? C } Damage Based Control attempts to minimize the L 2-norm of the difference between an ideal damage field and the computed damage field, Q ( u ( ? , x , t ) , ? ) = 1 2 ? ? ( u ( ? , x , t ) ) ? D i d e a l ( x ) ? L 2 ( ? ) 2 = 1 2 ? D ( x ) ? D i d e a l ( x ) ? L 2 ( ? ) 2 An ideal damage field, D ideal ( x ), maximizes damage to the cancerous region while maintaining functionality of the healthy region. Within the cancerous region there is a threshold damage value, denoted D C i d e a l , above which all cancerous cells will die. Similarly, within the healthy region there is a threshold damage value, denoted D H i d e a l , below which the functionality is maintained for all healthy cells. D i d e a l ( x ) ? { D C i d e a l x ? ? C D H i d e a l x ? ? H } The functional that acts on the temperature field and returns the corresponding damage field is denoted ? , ? : L 2 ( 0 , T , H 1 ( ? ) ) ? L 2 ( ? ) ? ( u ( ? , x , t ) ) = D ( x ) ? x ? ? The damage field, D ( x ), reflects the time-temperature thermal injury resulting from the application of the heat source. An Arrhenius model and a Two-State model [ 16 ] are used to quantify the damage from the thermal assault on the biological domain, ? . The Arrhenius model is a classical empirical law used in early models of thermal effects and properties of molecular averages. For the Arrhenius model, ' represents the damage index , and for the Two-State model, ? represents the cell viability . (2) ? ( u ( ? , x , t ) ) = D ( x ) = { ? 0 T A e ? E a R u d t Arrhenius ? 0 T e ? ( h u + ? t + ? ) 1 + e ? ( h u + ? t + ? ) d t Two-State } The constants E a , A , and R are known constants of the Arrhenius model and h , ? , and ? are known constants of the Two-State model determined from invitro experiments on cell samples [ 16 ]. Note that the numerical values of D C i d e a l and D H i d e a l for the Arrhenius model will be different from D C i d e a l and D H i d e a l for the Two-State model. Heat Shock Protein (HSP) Based Control is similar to damage control. It is assumed that the functional mapping the temperature field to the corresponding HSP expression field is known: H : L 2 0 , T , H 1 ? ) ) ? L 2 ( ? ) H ( u ( ? , x , t ) ) ( x ) ? L 2 ( ? ) The constitutive data mapping the temperature field to the HSP expression field is obtained from in vitro cellular data [ 17 ]. An ideal HSP expression field, H ideal ( x ), maximizes the protective effect of heat shock proteins within healthy tissue while minimizing heat shock protein expression within the cancerous region. A summary of the objective functions is provided as follows: (3) Q ( u ( ? , x , t ) , ? ) = { 1 2 ? ? ? 0 T ( u ( x , t ) ? u i d e a l ( x ) ) 2 d t d x calibration ? temp. based 1 2 ? ? ( ? 0 ? A e ? E a R u d t ? D i d e a l ( x ) ) 2 d x Arrhenius 1 2 ? ? ( ? 0 ? e ? ( h u + ? t + ? ) 1 + e ? ( h u + ? t + ? ) d t ? D i d e a l ( x ) ) 2 d x Two-State 1 2 ? ? ( H ( x ) ? H i d e a l ( x ) ) 2 d x HSP }  3.3 PDE Constrained Optimization The mathematical structure of the calibration and optimal control problems is the same: Find the set of model parameters ? *, that minimizes a given objective function, Q , over a parameter manifold, P , Find ? ? ? P s . t . Q ( u ( ? ? ) , ? ? ) = inf ? ? P Q ( u ( ? ) , ? ) subject to the constraints of a variational form of the Pennes PDE, C ( u , ? ; v ) : V × P × V ? R (4) ? v C ( u , ? ; v ) = 0 = ? 0 T ? ? ? c p ? u ? t v d x d t + ? 0 T ? ? k ( u , x , ? ) ? u ? ? v d x d t + ? 0 T ? ? ? ( u , x , ? ) c b l o o d ( u ? u a ) v d x d t + ? 0 T ? ? ? N G v d A d t ? ? 0 T ? ? Q l a s e r ( ? , x , t ) v d x d t + ? 0 T ? ? ? C h ( u ? u ? ) v d x d t The variational form (4) is nonlinear with respect to the first two arguments, u , ? , but linear with respect to the test function, v . The proper mathematical setting for the trial and test functions is the space of mappings from the time domain to the appropriate function space, H 1( ? ), u ( ? , x , t ) ? ( u ( ? , t ) ) ( x ) : ( 0 , T ) ? H 1 ( ? ) such that the H 1 norm of the mapping, u , is L 2 integrable in time, ? 0 T ? u ( ? , ? , t ) ? H 1 2 d t < ? The appropriate space containing such mappings is V ? L 2 ( 0 , T ; H 1 ( ? ) ) . A well-defined solution to the variational problem (4) may be shown to exist for model parameters, ? , belonging to a parameter space, P , (5) P = { ? ? L ? ( ? ) × R 3 × L ? ( ? ) × R 3 × L ? ( [ 0 , T ] ) × R 5 : 0 < k ? < k 0 ( x ) + k 1 atan ( k 2 ( u ? k 3 ) ) < k ? < ? 0 < ? ? < ? 0 ( x ) + ? 1 atan ( ? 2 ( u ? ? 3 ) ) < ? ? < ? } over which the operators are coercive, bounded, and type- M [ 18 ] . The gradient of the objective function with respect to the control variables is the work horse of our optimization schemes. The objective function is guaranteed to decrease in the direction of the gradient and is also used to approximate the Hessian in a quasi-Newton scheme. A Newton scheme for optimization is not considered in this work. The real-time nature of the control system does not permit the efficient computation of the Hessian of the objective function. An adjoint solution method of the optimization problems is used to compute the gradient. The adjoint method considered employs framework of differential calculus in Banach spaces and clearly demonstrates how the use of an adjoint variable eliminates the need to solve for sensitivities of the solution. An analytical expression for gradient of the objective function with respect to the control variables is determined under the assumption that the objective function and temperature field are Fréchet-differentiable 3 . Considering the Pennes model solution, u , as a function of the the control parameters, ? , and the objective function, Q , as a function of the Pennes model solution, u , and the control parameters, ? , the composition of the objective function with the Pennes model solution, denoted as Q ? u , may be considered as a Fréchet-differentiable mapping solely from parameter space to R . u ( ? ) : P ? V Q ( u , ? ) : V × P ? R Q ? u ? Q ( u ( ? ) , ? ) : P ? R The derivative of the composition, Q ? u , is of interest and is computed under the following first order approximations of the solution and objective function. u ( ? + ? ^ ) = u ( ? ) + u ? ( ? ) ? ^ Q ( u + u ^ , ? + ? ^ ) = Q ( u , ? ) + D u Q ( u , ? ) u ^ + D ? Q ( u , ? ) ? ^ Here u ? : P ? V denotes the Fréchet derivative of the solution with respect to the control variables, D u Q : V ? R is the partial Fréchet derivative with respect to the solution, and D ? Q : P ? R is the partial Fréchet derivative with respect to the control variables. For functions defined on the Cartesian products of spaces, the notion of partial Fréchet differentiability is understood as follows: Partial Fréchet-differentiability: Let X denote the direct sum of the space of trial functions and parameter space, X = V ? P . For U open, U ? X , and F : U ? Y consider the point x = ( u , ? ) ? X . Define f u ( z ) : V ? R f u ( z ) = F ( z , ? ) f ? ( s ) : P ? R f ? ( s ) = F ( u , s ) The Fréchet derivative of f u ( z ) at z = u and f ? ( s ) at s = ? are the partial derivatives F in the direction of u and ? ; respectively. D u F ( x ) : V ? R D u F ( x ) = D f u ( u ) D ? F ( x ) : P ? R D ? F ( x ) = D f ? ( ? ) The Fréchet derivative of F at ( u , ? ) is the sum ofits partial derivatives [ 19 ]. The chain rule holds for a composition of Fréchet differentiable functions [ 19 ]; the derivative of the composition is computed as follows, (6) D ( Q ? u ) : P ? R D ( Q ? u ) = D u Q ( u , ? ) u ? ( ? ) + D ? Q ( u , ? ) Notice that to compute the gradient of the objective function, Q , the sensitivities, u ?, must be computed. The variation of the PDE constraints with respect to the model parameters may be used to compute the sensitivities. Only model parameters for which a solution to the governing PDE exists are of interest (i.e. ? : C ( u ( ? ), ? ; v ) = 0 ? v ). Within this hyper-space the variation is identically zero. (7) ( D u C u ? + D ? C ) : P ? R D u C ( u , ? ; v ) u ? ( ? ) + D ? C ( u , ? ; v ) = 0 ? v ? V where D u C : V ? R is the partial Fréchet derivative of the PDE with respect to the solution and D ? C : P ? R is the partial Fréchet derivative of the PDE with respect to the model parameters. The adjoint method of computing the gradient of the objective function may now be formulated. Theorem . Given ? ? P , the derivative of the objective function is (8) D ( Q ? u ) = D ? Q ( u ( ? ) , ? ) ? D ? C ( u ( ? ) , ? ; p ) where u ? V is the solution of the Pennes model and p ? V is the solution to the adjoint problem. Find p ? V : ? D u C ( u ( ? ) , ? ; p ) , u ^ ? V ? × V = ? D u Q ( u ( ? ) , ? ) , u ^ ? V ? × V ? u ^ ? V Proof. For a fixed ? , the solution to the adjoint problem, p , satisfies ? D u C ( u ( ? ) , ? ; p ) , u ? ? V ? ? V = ? D u Q ( u ( ? ) , ? ) u ? ? V ? × V From the first variation of the PDE constraints (7) , we have that D u C ( u ( ? ) , ? ; p ) u ? ( ? ) = ? D ? C ( u ( ? ) , ? ; p ) The gradient follows from a direct substitution in (6) to eliminate the sensitivities: D ( Q ? u ) = D u Q ( u , ? ) u ? ( ? ) + D ? Q ( u , ? ) = D ? Q ( u , ? ) ? D ? C ( u ( ? ) , ? ; p ) Recall that D ( Q ? u ) is an operator on the parameter space, P , and the desired solution, ? , is such that D ( Q ? u ) ( ? ) = 0 ? ? D ( Q ? u ) ( ? ) , ? ^ ? = 0 ? ? ^ ? P As a concrete example, the strong form of the adjoint problem is derived from the Fréchet derivatives used to derive (8) . The following Taylor series expansions are used in computing the derivatives of the variational form of Pennes model: k ( u + u ^ , ? + ? ^ ) = k ( u , ? ) + u ^ ? k ? u + k ^ 0 ? k ? k 0 + k ^ 1 ? k ? k 1 + k ^ 2 ? k ? k 2 + k ^ 3 ? k ? k 3 + h . o . t . ? ( u + u ^ , ? + ? ^ ) = ? ( u , ? ) + u ^ ? ? ? u + ? ^ 0 ? ? ? ? 0 + ? ^ 1 ? ? ? ? 1 + ? ^ 2 ? ? ? ? 2 + ? ^ 3 ? ? ? ? 3 + h . o . t . An alternative formulation of (4) must be used to account for the initial condition. The initial condition is accounted for in the variational form by integrating by parts on the time derivative. ? ? ? c p [ u ( x , 0 ) p ( x , 0 ) ? u ( x , T ) p ( x , T ) ] d x = ? 0 T ? ? ? c p ( ? u ? t p + ? p ? t u ) d x d t Recognizing that u 0( x ) = u ( x , 0) and not testing the equation at the final time, p ( x , T ) = 0, leads to the following C ( u , ? ; p ) = ? ? 0 T ? ? ? c p ? p ? t u d x d t + ? 0 T ? ? k ( u , ? ) ? u ? ? p d x d t + ? 0 ? ? ? c b l o o d ? ( u , ? ) ( u ? u a ) p d x d t + ? 0 T ? ? ? h u p d A d t + ? ? u 0 ( x ) p ( x , 0 ) d x Applying the definition of the partial Fréchet derivative to the variational PDE gives C ( u + u ^ , ? ; p ) = ? ? 0 T ? ? ? c p ? p ? t ( u + u ^ ) d x d t + k ( u + u ^ , ? ) ? ( u + u ^ ) ? ? p d x d t + ? 0 T ? ? c b l o o d ? ( u + u ^ , ? ) ( ( u + u ^ ) ? u a ) p d x d t + ? 0 T ? ? ? h ( u + u ^ ) p d A d t + ? ? u 0 ( x ) p ( x , 0 ) d x Substituting the Taylor series expansion for k and ? and rearranging terms gives C ( u + u ^ , ? ; p ) ? C ( u , ? ; p ) = [ ? ? 0 T ? ? ? c p ? p ? t u ^ d x d t + ? 0 T ? ? ? h u ^ p d A d t + ? 0 T ? ? ( k ( u , ? ) ? u ^ ? ? p + u ^ ? k ? u ? u ? ? p ) d x d t + ? 0 T ? ? ( ? ( u , ? ) u ^ p + u ^ ? ? ? u ( u ? u a ) p ) d x d t + ? 0 T ? ? ( u ^ k ( u , ? ) ? u ^ ? ? p + 1 2 u ^ 2 ? 2 k ? u 2 ? u ? ? p ) d x d t + … ] Notice that the terms involving the initial condition cancel out. Letting D u C ( u , ? ; p ) u ^ = ? 0 T ? ? ? c p ? u ^ ? t p d x d t + ? 0 T ? ? ? h u ^ p d A d t + ? 0 T ? ? k ( u , ? ) ? u ^ ? ? p + u ^ ? k ? u ? u ? ? p d x d t + ? 0 T ? ? ? ( u , ? ) u ^ p + u ^ ? ? ? u ( u ? u a ) p d x d t implies that (9) ? C ( u + u ^ , ? ; p ) ? C ( u , ? ; p ) ? D u C ( u , ? ; p ) u ^ ? ? C ~ ? u ^ ? 2 where the higher order terms of the thermal conductivity, ? 2 k ? u 2 , and perfusion, ? 2 ? ? u 2 , are assumed bounded and hidden in the constant, C? . For a particular test/adjoint function, p , the constant, C? , also depends on the norm of the test/adjoint function, ? p ?; however, because p ? V , the norm is always bounded and (9) holds. It follows from the definition that D uC ( u , ? ; p ) is the Fréchet derivative of C . The strong form of the adjoint formulation is as follows. ? ? c p ? p ? t ? ? ? ( k ( u , x , ? ) ? p ) + ? k ? u ( u , x , ? ) ? u ? ? p + ? ( u , x , ? ) p + ? ? ? u ( u , x , ? ) p ( u ? u a ) = ? Q in ? ? k ( u , x , ? ) ? p ? n = h p on ? ? p ( x , T ) = 0 in ? Notice that the adjoint problem for the calibration, optimal control, and goal oriented error estimates are all essentially the same, the only difference being the source term ?Q which depends on the quantity of interest.  3.4 Discretization of Equations The Galerkin representations of the temperature field and adjoint variable are assumed as follows u ( x , t ) = ? k = 1 N s t e p ? j = 1 N d o f ? j k ( t ) ? j ( x ) p ( x , t ) = ? k = 1 N s t e p ? i = 1 N d o f ? i k ( t ) ? i ( x ) where N step is the number of time steps, N dof is the number of Galerkin coefficients, and ? i 's are the finite element shape functions. ? j k ( t ) = { t k ? t t k ? t k ? 1 ? j k ? 1 + t ? t k ? 1 t k ? t k ? 1 ? j k , t ? [ t k ? 1 , t k ) 0 , otherwise } ? i k ( t ) = { ? i k , t ? [ t k ? 1 , t k ) 0 , otherwise } The time discretization of the power is assumed piecewise constant in time: P ( t ) = { P k , t ? [ t k ? 1 , t k ) 0 , otherwise } The spatial variation of the parameters fields is assumed to have the following Galerkin representation, k 0 ( x ) = ? j k 0 j ? j ( x ) ? 0 ( x ) = ? j ? 0 j ? j ( x ) where ? ( x ) are piecewise constant across elements. The test function are assumed piecewise constant in time v ( x , t ) = ? k = 1 N s t e p ? i = 1 N d o f v i k ( t ) ? i ( x ) v i k ( t ) = { v i k , t ? [ t k ? 1 , t k ) 0 , otherwise } The governing equations (4) are solved using a Crank-Nicolson time stepping scheme. The Adjoint Gradient of the quantity of interest is constructed from the derivative of the discretized equations with respect to an arbitrary single model variable, ? i . The gradient of the quantity of interest is computed using the chain rule for derivatives taken with respect to the numerically computed quantity of interest. The initial condition does not depend on the model parameters, ? u 0 ? ? i = 0 . ? ? ? i Q ( u ( ? , x , t ) , ? ) = ? k = 1 N s t e p ? Q ? u k ? u k ? ? i As shown in [ 7 ], the numerical derivative of the quantity of interest with respect to a model variable may be computed as follows. ? Q ( u , ? ) ? ? i = ? k = 1 N s t e p ( ? ? t k ? ? ? k ? ? i ( u k ? 1 2 , x , ? ) ? u k ? 1 2 ? ? p k d x ? ? t k ? ? c b l o o d ? ? ? ? i ( u k ? 1 2 , x , ? ) ( u k ? 1 2 ? u a ) p k d x + ? t k ? ? ? Q l a s e r ? ? i ( ? , x , t k ) p k d x )  4 Results In this section, results from phantom testing and in-vivo experiments of the the control system are presented along with post-treatment histology for comparison with computed predictions. Performance results used in the design of the treatment protocols are also provided. All computations use the GMRES linear solver and block Jacobi preconditioner available from PETSc [ 10 ]. A bound constrained quasi-Newton linesearch method available in TAO [ 11 ] is used for the optimization solution. The linesearch is based on the Wolfe conditions, sufficient decrease and curvature, and a uses a quadratic/cubic interpolation scheme for the step length selection. 4.1 Phantom Validation Tests Developmental stages uses a series of so-called phantom experiments constructed to provide a preliminary validation setting for the mathematical and computational models developed in this study; the phantoms are constructed from ex vivo canine prostate tissue embedded within a 1% agar material, Figure 9 . The phantom provides an animal-free method of testing and debugging every aspect of the control system in a controlled and repeatable manner without interference from confounding conditions such as time varying perfusion as expected in the in-vivo system. The phantom is meshed, registered, and the computational models in Austin are used to control the heating. The heating of the phantom is visible in the MRTI images. Thermal images of the heating are acquired and sent to the HP3d program; HP3d calibrates and optimizes the model parameters, and finally, a visualization of the entire process is provided in Houston. Figure 14 shows a post calibration time instance of the predicted temperature of the phantom heated with an interstitial laser fiber. A visualization of the anatomy, predicted temperature contours, predicted damage contours, cutlines of the baseline thermal images, and cutlines of the heating predicted by Pennes model are shown. As there is no perfusion within the excised tissue, Pennes model reduces to a nonlinear heat transfer equation. The anatomy images are used to obtain the initial coordinates of the laser tip in the FEM calculations. As illustrated by the power profile, Figure 14 (e) , the phantom was pulsed heated with the laser source at 8 Watts applied power for 30 seconds. Imaging of the heating and cooling is used for model calibration; in this particular trial, thermal imaging data was only acquired for calibration. The initial pulse used for model calibration is seen to mildly damage the prostate before the optimal control portion of the experiment, Figure 14 (b) . The optimal power profile shown was computed to simulate Damage Based Control using the Arrhenius model (2) to optimally heat of a tumor of radius 1.5cm. The profile shown maximizes damage to the tumor and minimizes damage to the surrounding healthy tissue by following a pulse heating with a tapering of the laser power; the computed profile begins at image step id 120 shown in Figure 14 (e) . The tapering allows heat to diffuse through the tumor without overheating the healthy tissue. The contour plots of the thermal images and the calibrated Pennes model predictions is seen to differ, Figure 14 (a) and (d) . As expected from modeling the medium as homogeneous with isotropic heating, the Pennes model prediction shows circular contours compared to the more elliptical shape seen in the thermal image contours. However, the particular time instance illustrates very good cutline agreement between the thermal images and the Pennes model prediction. Figure 14 (f) . Also shown are cutlines of the filtered and unfiltered thermal images Figure 14 (c) . 4.2 Treatment Protocol Design The execution time and speedup of a representative 10 second bioheat transfer simulation is presented in Figure 10 . The execution times represent 10 nonlinear state solves of the Pennes model (10 one second time steps) combined with 10 linear adjoint solves to be used in the gradient computation for calibration, optimal control, and/or error estimates. A finite element mesh consisting of approximately 10,000 degrees of freedom is used to characterize the computational performance. The results presented may be used as a template for extrapolating to more realistic computational models with larger degrees of freedom. Computations were done at the computational arena at TACC on a Dual-Core Linux Cluster. Each node of the cluster contains two Xeon Intel Duo-Core 64-bit processors (4 cores in all) on a single board, as an SMP unit. The core frequency is 2.66GHz and supports 4 floating-point operations per clock period. The fastest time recorded is .67 seconds. Furthermore, as shown in [ 20 ], the optimizer is seen to be capable of converging to a solution in under 10 function/gradient evaluations. Hence, an estimated time of 2.5 minutes of computation time is needed for the calibration computations using 150 seconds worth of data - 30 images with a 5 second acquisition time, using a ratio of 10 seconds of computation time to 1 second of wall time, and allowing for 10 function/gradient evaluations. 4.3 <italic>In-Vivo</italic> Experiments The control system, in its entirety, has been twice tested on in-vivo canine prostate tissue. Registration results from both tests are similar; the first is presented. The most recent trial of the actual treatment is presented. Handling of animals was in accordance to an Institutional Animal Care and Use Committee approved protocol. General anesthesia was induced, utilizing meditomidine (0.5 mg/kg, intramuscular) and 2% isoflurane was used to maintain general anesthesia. Axial and coronal planning images were acquired using a 1.5T MR scanner (EXCITE HD GE Medical Systems, WI) with a GE 8 4-channel, receive-only phased-array body coil (MRI Devices Corp, Gainesville, FL). Pre-operative axial imaging data of the canine prostate and the neighboring anatomy was used to create a FEM mesh, Figure 11 . The pre-operative imaging data was taken at a resolution of 256×256×36 voxels with a field of view of 240mm×240mm and an out of plane thickness of 3mm with slice spacing of 1.5mm. The FEM mesh consisted of 23,303 dof and 20,064 hexahedral elements. A pipeline of commercial software was used to generate the mesh. AMIRA, www.amiravis.com , was used to perform a semi-automatic segmentation of the prostate and create a faceted surface representation of the prostate. CUBIT, cubit.sandia.gov, was used to convert the faceted surface into a hexahedral mesh and apply boundary conditions. Zero flux ( G = 0 ) boundary conditions are used; heating is not expected to reach the outer boundary of the prostate. Intra-operative axial imaging data is shown in Figure 11 . The intra-operative imaging data was taken at a resolution of 256×256×12 voxels with a field of view of 240mm×240mm and an out of plane spacing of 3mm. Comparison of the pre-operative image and the intra-operative image reveals that the prostate has moved a significant amount which poses a significant registration problem. Current capabilities permit rigid registration only. The rigid registration is based on detecting the outer surface of the canine, not the prostate within. The rigid registration code 4 found the out-of-plane position but failed in-plane due to the prostate movement. Consequently, the mesh was registered manually using AVS for interactive visualization. Furthermore, stringent time constraints on the experiment do not permit the use of the full resolution volume data sets for the rigid registration. The volume data sets must be subsampled to facilitate a reasonable execution time of the serial rigid registration code. However, for rigid registration, subsampling the imaging data by a factor of four in-plane does not lose much information on the outer boundary of the anatomy of the canine and significantly speeds up the registration from approximately twenty-five minutes to roughly two minutes with about 1mm difference in the final result. A planning template was placed on the perineum of the dogs. Coronal images, field of view 20cm×20cm, slice thickness 1.5mm, covering the template and the prostate were input into the template planning program of the Visualase. Three fiducials on the template were identified allowing trajectories to be projected through the prostate volume. A stainless steel stylet was used for inserting the laser catheters, 400 micron core diameter silica fiber in a water-cooled diffused tip catheter, to reach the prostate at a depth of approximately 6cm. The final catheter location was estimated using another set of coronal images. The estimated location of the laser, in DICOM coordinates, was given to HP3d to begin the treatment. A late time treatment image of the control system applied to in-vivo laser treatment of canine prostate is shown in Figure 15 ; the entire duration of the treatment was 18 minutes. As shown, Figure 15 (b) , the goal was to demonstrate that the computational model could control the bioheat transfer and heat a region of 1.2cm in diameter to 60°C. As illustrated in the power history, Figure 15 (e) , the treatment protocol is divided into the four stages described in Figure 4 . During the first stage, the biological domain is pulse heated and MRTI thermal image data is acquired for the heating as well as the cooling. The following parameters were used: field of view = 24 cm, slice thickness = 4 mm, echo train length = 8, acquisition matrix = 256 × 128, repetition time = 545 ms, echo time = 15 ms and flip angle = 60° and five slices were collected per time point. The model calibration is divided into a 180 second data acquisition phase followed by a 180 second computation phase. For the in-vivo experiments, the canine prostate tissue was heated with a 5W pulse for 90 seconds; a 180 second imaging period is used capture the cooling of the in-vivo prostate tissue as well as the heating. The acquired imaging data is used for model calibration computations. The treatment-day thermal imaging data generated for the canine exhibits significant decrease in the signal-to-noise ratio compared to those of the phantom experiments; the positioning grid separated the top coil from the surface of the canine's skin and separated it even further from it's complimentary coil underneath the animal. The use of a calibration pulse of less that 5 W applied power on a previous experiment resulted in minimal heating, suggesting that that the deposited energy was quickly dissipated by blood perfusion and any heating seen was masked by the noise range of the thermal imaging. The treatment imaging data shown in Figure 15 (c) uses a space-time filter; in addition to a spatial median-deriche filtering pipeline, if the thermal data at a pixel changes by more than 11°C it is considered noise and filtered. The 11°C threshold is based on intuition from previous in-vivo experiments. The second stage of the treatment accounts for the time span of the calculations that use the imaging data for model calibration. The third stage accounts for the time delay to recompute the patient-specific optimal temperature/ damage/ HSP heating protocol. The laser is prevented from entering a standby mode through a series of keep-alive pulses during the computational phase. In the fourth and final stage, the optimal laser control parameters are applied to the biological domain. For this particular trial, the perfusion, thermal conductivity, absorption coefficient, and laser position were calibrated. Results of the real-time calibration computations moved the laser tip 5mm from the initial estimated position. Cutlines illustrating the temperature as function of distance are taken through the thermal imaging data and finite element predictions for comparison. The location of the cutline is illustrated in the Anatomy and Thermal Images, Figure 15 (a) . The bottom right cutline, Figure 15 (f) , shows good agreement between the desired treatment plan, the computation prediction, and the experimentally measured MRTI temperature field. A drift in the temperature imaging on the order of -1.7°C was seen over the course the 18min treatment time; implying that the thermal image value may be slighty higher than shown. However, the drift at the beginning of the treatment was insignificant during the 90 second thermal image acquisition for the calibration. The prostate was excised immediately after exsanguination. It was fixed in formalin for 4 days, and then sectioned with guidance of the MR slice locations; this provided pathology slices which were congruent to the post-treatment MR images for comparison, Figure 12 . The damage region was within the targeted 1.2cm diameter treatment objective. The actual power history recorded by the Visualase for the two experiments is shown in Figure 13 . The actual and predicted history are seen to be in very good agreement. However, the minor time delays seen result in a random single pulse not being physically manifested; but, post-treatment computations show that the delay seen in the power control is of little consequence. The six second 15 Watts spike missing from the Visualase log, Figure 13 (a) , has an insignificant effect on the model predictions. Figure 13 (a) also shows that copying the power control file directly to the mounted Visualase directory interferes with Visualase power log and instantaneously turns the laser off. The problem is a result of the file system architecture. Overwriting by copying the file instantaneously deletes the file which instantaneously turns the power off. The fix is trivial, overwriting the file by moving does not delete the file and simply changes the file pointers, Figure 13 (b) . The sharp rise in power to 9 watts at the end of the time history of the Visualase log file, Figure 13 (a) , is due to a manual override of the laser control during the earlier canine experiment.  4 Results In this section, results from phantom testing and in-vivo experiments of the the control system are presented along with post-treatment histology for comparison with computed predictions. Performance results used in the design of the treatment protocols are also provided. All computations use the GMRES linear solver and block Jacobi preconditioner available from PETSc [ 10 ]. A bound constrained quasi-Newton linesearch method available in TAO [ 11 ] is used for the optimization solution. The linesearch is based on the Wolfe conditions, sufficient decrease and curvature, and a uses a quadratic/cubic interpolation scheme for the step length selection. 4.1 Phantom Validation Tests Developmental stages uses a series of so-called phantom experiments constructed to provide a preliminary validation setting for the mathematical and computational models developed in this study; the phantoms are constructed from ex vivo canine prostate tissue embedded within a 1% agar material, Figure 9 . The phantom provides an animal-free method of testing and debugging every aspect of the control system in a controlled and repeatable manner without interference from confounding conditions such as time varying perfusion as expected in the in-vivo system. The phantom is meshed, registered, and the computational models in Austin are used to control the heating. The heating of the phantom is visible in the MRTI images. Thermal images of the heating are acquired and sent to the HP3d program; HP3d calibrates and optimizes the model parameters, and finally, a visualization of the entire process is provided in Houston. Figure 14 shows a post calibration time instance of the predicted temperature of the phantom heated with an interstitial laser fiber. A visualization of the anatomy, predicted temperature contours, predicted damage contours, cutlines of the baseline thermal images, and cutlines of the heating predicted by Pennes model are shown. As there is no perfusion within the excised tissue, Pennes model reduces to a nonlinear heat transfer equation. The anatomy images are used to obtain the initial coordinates of the laser tip in the FEM calculations. As illustrated by the power profile, Figure 14 (e) , the phantom was pulsed heated with the laser source at 8 Watts applied power for 30 seconds. Imaging of the heating and cooling is used for model calibration; in this particular trial, thermal imaging data was only acquired for calibration. The initial pulse used for model calibration is seen to mildly damage the prostate before the optimal control portion of the experiment, Figure 14 (b) . The optimal power profile shown was computed to simulate Damage Based Control using the Arrhenius model (2) to optimally heat of a tumor of radius 1.5cm. The profile shown maximizes damage to the tumor and minimizes damage to the surrounding healthy tissue by following a pulse heating with a tapering of the laser power; the computed profile begins at image step id 120 shown in Figure 14 (e) . The tapering allows heat to diffuse through the tumor without overheating the healthy tissue. The contour plots of the thermal images and the calibrated Pennes model predictions is seen to differ, Figure 14 (a) and (d) . As expected from modeling the medium as homogeneous with isotropic heating, the Pennes model prediction shows circular contours compared to the more elliptical shape seen in the thermal image contours. However, the particular time instance illustrates very good cutline agreement between the thermal images and the Pennes model prediction. Figure 14 (f) . Also shown are cutlines of the filtered and unfiltered thermal images Figure 14 (c) . 4.2 Treatment Protocol Design The execution time and speedup of a representative 10 second bioheat transfer simulation is presented in Figure 10 . The execution times represent 10 nonlinear state solves of the Pennes model (10 one second time steps) combined with 10 linear adjoint solves to be used in the gradient computation for calibration, optimal control, and/or error estimates. A finite element mesh consisting of approximately 10,000 degrees of freedom is used to characterize the computational performance. The results presented may be used as a template for extrapolating to more realistic computational models with larger degrees of freedom. Computations were done at the computational arena at TACC on a Dual-Core Linux Cluster. Each node of the cluster contains two Xeon Intel Duo-Core 64-bit processors (4 cores in all) on a single board, as an SMP unit. The core frequency is 2.66GHz and supports 4 floating-point operations per clock period. The fastest time recorded is .67 seconds. Furthermore, as shown in [ 20 ], the optimizer is seen to be capable of converging to a solution in under 10 function/gradient evaluations. Hence, an estimated time of 2.5 minutes of computation time is needed for the calibration computations using 150 seconds worth of data - 30 images with a 5 second acquisition time, using a ratio of 10 seconds of computation time to 1 second of wall time, and allowing for 10 function/gradient evaluations. 4.3 <italic>In-Vivo</italic> Experiments The control system, in its entirety, has been twice tested on in-vivo canine prostate tissue. Registration results from both tests are similar; the first is presented. The most recent trial of the actual treatment is presented. Handling of animals was in accordance to an Institutional Animal Care and Use Committee approved protocol. General anesthesia was induced, utilizing meditomidine (0.5 mg/kg, intramuscular) and 2% isoflurane was used to maintain general anesthesia. Axial and coronal planning images were acquired using a 1.5T MR scanner (EXCITE HD GE Medical Systems, WI) with a GE 8 4-channel, receive-only phased-array body coil (MRI Devices Corp, Gainesville, FL). Pre-operative axial imaging data of the canine prostate and the neighboring anatomy was used to create a FEM mesh, Figure 11 . The pre-operative imaging data was taken at a resolution of 256×256×36 voxels with a field of view of 240mm×240mm and an out of plane thickness of 3mm with slice spacing of 1.5mm. The FEM mesh consisted of 23,303 dof and 20,064 hexahedral elements. A pipeline of commercial software was used to generate the mesh. AMIRA, www.amiravis.com , was used to perform a semi-automatic segmentation of the prostate and create a faceted surface representation of the prostate. CUBIT, cubit.sandia.gov, was used to convert the faceted surface into a hexahedral mesh and apply boundary conditions. Zero flux ( G = 0 ) boundary conditions are used; heating is not expected to reach the outer boundary of the prostate. Intra-operative axial imaging data is shown in Figure 11 . The intra-operative imaging data was taken at a resolution of 256×256×12 voxels with a field of view of 240mm×240mm and an out of plane spacing of 3mm. Comparison of the pre-operative image and the intra-operative image reveals that the prostate has moved a significant amount which poses a significant registration problem. Current capabilities permit rigid registration only. The rigid registration is based on detecting the outer surface of the canine, not the prostate within. The rigid registration code 4 found the out-of-plane position but failed in-plane due to the prostate movement. Consequently, the mesh was registered manually using AVS for interactive visualization. Furthermore, stringent time constraints on the experiment do not permit the use of the full resolution volume data sets for the rigid registration. The volume data sets must be subsampled to facilitate a reasonable execution time of the serial rigid registration code. However, for rigid registration, subsampling the imaging data by a factor of four in-plane does not lose much information on the outer boundary of the anatomy of the canine and significantly speeds up the registration from approximately twenty-five minutes to roughly two minutes with about 1mm difference in the final result. A planning template was placed on the perineum of the dogs. Coronal images, field of view 20cm×20cm, slice thickness 1.5mm, covering the template and the prostate were input into the template planning program of the Visualase. Three fiducials on the template were identified allowing trajectories to be projected through the prostate volume. A stainless steel stylet was used for inserting the laser catheters, 400 micron core diameter silica fiber in a water-cooled diffused tip catheter, to reach the prostate at a depth of approximately 6cm. The final catheter location was estimated using another set of coronal images. The estimated location of the laser, in DICOM coordinates, was given to HP3d to begin the treatment. A late time treatment image of the control system applied to in-vivo laser treatment of canine prostate is shown in Figure 15 ; the entire duration of the treatment was 18 minutes. As shown, Figure 15 (b) , the goal was to demonstrate that the computational model could control the bioheat transfer and heat a region of 1.2cm in diameter to 60°C. As illustrated in the power history, Figure 15 (e) , the treatment protocol is divided into the four stages described in Figure 4 . During the first stage, the biological domain is pulse heated and MRTI thermal image data is acquired for the heating as well as the cooling. The following parameters were used: field of view = 24 cm, slice thickness = 4 mm, echo train length = 8, acquisition matrix = 256 × 128, repetition time = 545 ms, echo time = 15 ms and flip angle = 60° and five slices were collected per time point. The model calibration is divided into a 180 second data acquisition phase followed by a 180 second computation phase. For the in-vivo experiments, the canine prostate tissue was heated with a 5W pulse for 90 seconds; a 180 second imaging period is used capture the cooling of the in-vivo prostate tissue as well as the heating. The acquired imaging data is used for model calibration computations. The treatment-day thermal imaging data generated for the canine exhibits significant decrease in the signal-to-noise ratio compared to those of the phantom experiments; the positioning grid separated the top coil from the surface of the canine's skin and separated it even further from it's complimentary coil underneath the animal. The use of a calibration pulse of less that 5 W applied power on a previous experiment resulted in minimal heating, suggesting that that the deposited energy was quickly dissipated by blood perfusion and any heating seen was masked by the noise range of the thermal imaging. The treatment imaging data shown in Figure 15 (c) uses a space-time filter; in addition to a spatial median-deriche filtering pipeline, if the thermal data at a pixel changes by more than 11°C it is considered noise and filtered. The 11°C threshold is based on intuition from previous in-vivo experiments. The second stage of the treatment accounts for the time span of the calculations that use the imaging data for model calibration. The third stage accounts for the time delay to recompute the patient-specific optimal temperature/ damage/ HSP heating protocol. The laser is prevented from entering a standby mode through a series of keep-alive pulses during the computational phase. In the fourth and final stage, the optimal laser control parameters are applied to the biological domain. For this particular trial, the perfusion, thermal conductivity, absorption coefficient, and laser position were calibrated. Results of the real-time calibration computations moved the laser tip 5mm from the initial estimated position. Cutlines illustrating the temperature as function of distance are taken through the thermal imaging data and finite element predictions for comparison. The location of the cutline is illustrated in the Anatomy and Thermal Images, Figure 15 (a) . The bottom right cutline, Figure 15 (f) , shows good agreement between the desired treatment plan, the computation prediction, and the experimentally measured MRTI temperature field. A drift in the temperature imaging on the order of -1.7°C was seen over the course the 18min treatment time; implying that the thermal image value may be slighty higher than shown. However, the drift at the beginning of the treatment was insignificant during the 90 second thermal image acquisition for the calibration. The prostate was excised immediately after exsanguination. It was fixed in formalin for 4 days, and then sectioned with guidance of the MR slice locations; this provided pathology slices which were congruent to the post-treatment MR images for comparison, Figure 12 . The damage region was within the targeted 1.2cm diameter treatment objective. The actual power history recorded by the Visualase for the two experiments is shown in Figure 13 . The actual and predicted history are seen to be in very good agreement. However, the minor time delays seen result in a random single pulse not being physically manifested; but, post-treatment computations show that the delay seen in the power control is of little consequence. The six second 15 Watts spike missing from the Visualase log, Figure 13 (a) , has an insignificant effect on the model predictions. Figure 13 (a) also shows that copying the power control file directly to the mounted Visualase directory interferes with Visualase power log and instantaneously turns the laser off. The problem is a result of the file system architecture. Overwriting by copying the file instantaneously deletes the file which instantaneously turns the power off. The fix is trivial, overwriting the file by moving does not delete the file and simply changes the file pointers, Figure 13 (b) . The sharp rise in power to 9 watts at the end of the time history of the Visualase log file, Figure 13 (a) , is due to a manual override of the laser control during the earlier canine experiment.  4.1 Phantom Validation Tests Developmental stages uses a series of so-called phantom experiments constructed to provide a preliminary validation setting for the mathematical and computational models developed in this study; the phantoms are constructed from ex vivo canine prostate tissue embedded within a 1% agar material, Figure 9 . The phantom provides an animal-free method of testing and debugging every aspect of the control system in a controlled and repeatable manner without interference from confounding conditions such as time varying perfusion as expected in the in-vivo system. The phantom is meshed, registered, and the computational models in Austin are used to control the heating. The heating of the phantom is visible in the MRTI images. Thermal images of the heating are acquired and sent to the HP3d program; HP3d calibrates and optimizes the model parameters, and finally, a visualization of the entire process is provided in Houston. Figure 14 shows a post calibration time instance of the predicted temperature of the phantom heated with an interstitial laser fiber. A visualization of the anatomy, predicted temperature contours, predicted damage contours, cutlines of the baseline thermal images, and cutlines of the heating predicted by Pennes model are shown. As there is no perfusion within the excised tissue, Pennes model reduces to a nonlinear heat transfer equation. The anatomy images are used to obtain the initial coordinates of the laser tip in the FEM calculations. As illustrated by the power profile, Figure 14 (e) , the phantom was pulsed heated with the laser source at 8 Watts applied power for 30 seconds. Imaging of the heating and cooling is used for model calibration; in this particular trial, thermal imaging data was only acquired for calibration. The initial pulse used for model calibration is seen to mildly damage the prostate before the optimal control portion of the experiment, Figure 14 (b) . The optimal power profile shown was computed to simulate Damage Based Control using the Arrhenius model (2) to optimally heat of a tumor of radius 1.5cm. The profile shown maximizes damage to the tumor and minimizes damage to the surrounding healthy tissue by following a pulse heating with a tapering of the laser power; the computed profile begins at image step id 120 shown in Figure 14 (e) . The tapering allows heat to diffuse through the tumor without overheating the healthy tissue. The contour plots of the thermal images and the calibrated Pennes model predictions is seen to differ, Figure 14 (a) and (d) . As expected from modeling the medium as homogeneous with isotropic heating, the Pennes model prediction shows circular contours compared to the more elliptical shape seen in the thermal image contours. However, the particular time instance illustrates very good cutline agreement between the thermal images and the Pennes model prediction. Figure 14 (f) . Also shown are cutlines of the filtered and unfiltered thermal images Figure 14 (c) .  4.1 Phantom Validation Tests Developmental stages uses a series of so-called phantom experiments constructed to provide a preliminary validation setting for the mathematical and computational models developed in this study; the phantoms are constructed from ex vivo canine prostate tissue embedded within a 1% agar material, Figure 9 . The phantom provides an animal-free method of testing and debugging every aspect of the control system in a controlled and repeatable manner without interference from confounding conditions such as time varying perfusion as expected in the in-vivo system. The phantom is meshed, registered, and the computational models in Austin are used to control the heating. The heating of the phantom is visible in the MRTI images. Thermal images of the heating are acquired and sent to the HP3d program; HP3d calibrates and optimizes the model parameters, and finally, a visualization of the entire process is provided in Houston. Figure 14 shows a post calibration time instance of the predicted temperature of the phantom heated with an interstitial laser fiber. A visualization of the anatomy, predicted temperature contours, predicted damage contours, cutlines of the baseline thermal images, and cutlines of the heating predicted by Pennes model are shown. As there is no perfusion within the excised tissue, Pennes model reduces to a nonlinear heat transfer equation. The anatomy images are used to obtain the initial coordinates of the laser tip in the FEM calculations. As illustrated by the power profile, Figure 14 (e) , the phantom was pulsed heated with the laser source at 8 Watts applied power for 30 seconds. Imaging of the heating and cooling is used for model calibration; in this particular trial, thermal imaging data was only acquired for calibration. The initial pulse used for model calibration is seen to mildly damage the prostate before the optimal control portion of the experiment, Figure 14 (b) . The optimal power profile shown was computed to simulate Damage Based Control using the Arrhenius model (2) to optimally heat of a tumor of radius 1.5cm. The profile shown maximizes damage to the tumor and minimizes damage to the surrounding healthy tissue by following a pulse heating with a tapering of the laser power; the computed profile begins at image step id 120 shown in Figure 14 (e) . The tapering allows heat to diffuse through the tumor without overheating the healthy tissue. The contour plots of the thermal images and the calibrated Pennes model predictions is seen to differ, Figure 14 (a) and (d) . As expected from modeling the medium as homogeneous with isotropic heating, the Pennes model prediction shows circular contours compared to the more elliptical shape seen in the thermal image contours. However, the particular time instance illustrates very good cutline agreement between the thermal images and the Pennes model prediction. Figure 14 (f) . Also shown are cutlines of the filtered and unfiltered thermal images Figure 14 (c) .  4.2 Treatment Protocol Design The execution time and speedup of a representative 10 second bioheat transfer simulation is presented in Figure 10 . The execution times represent 10 nonlinear state solves of the Pennes model (10 one second time steps) combined with 10 linear adjoint solves to be used in the gradient computation for calibration, optimal control, and/or error estimates. A finite element mesh consisting of approximately 10,000 degrees of freedom is used to characterize the computational performance. The results presented may be used as a template for extrapolating to more realistic computational models with larger degrees of freedom. Computations were done at the computational arena at TACC on a Dual-Core Linux Cluster. Each node of the cluster contains two Xeon Intel Duo-Core 64-bit processors (4 cores in all) on a single board, as an SMP unit. The core frequency is 2.66GHz and supports 4 floating-point operations per clock period. The fastest time recorded is .67 seconds. Furthermore, as shown in [ 20 ], the optimizer is seen to be capable of converging to a solution in under 10 function/gradient evaluations. Hence, an estimated time of 2.5 minutes of computation time is needed for the calibration computations using 150 seconds worth of data - 30 images with a 5 second acquisition time, using a ratio of 10 seconds of computation time to 1 second of wall time, and allowing for 10 function/gradient evaluations.  4.2 Treatment Protocol Design The execution time and speedup of a representative 10 second bioheat transfer simulation is presented in Figure 10 . The execution times represent 10 nonlinear state solves of the Pennes model (10 one second time steps) combined with 10 linear adjoint solves to be used in the gradient computation for calibration, optimal control, and/or error estimates. A finite element mesh consisting of approximately 10,000 degrees of freedom is used to characterize the computational performance. The results presented may be used as a template for extrapolating to more realistic computational models with larger degrees of freedom. Computations were done at the computational arena at TACC on a Dual-Core Linux Cluster. Each node of the cluster contains two Xeon Intel Duo-Core 64-bit processors (4 cores in all) on a single board, as an SMP unit. The core frequency is 2.66GHz and supports 4 floating-point operations per clock period. The fastest time recorded is .67 seconds. Furthermore, as shown in [ 20 ], the optimizer is seen to be capable of converging to a solution in under 10 function/gradient evaluations. Hence, an estimated time of 2.5 minutes of computation time is needed for the calibration computations using 150 seconds worth of data - 30 images with a 5 second acquisition time, using a ratio of 10 seconds of computation time to 1 second of wall time, and allowing for 10 function/gradient evaluations.  4.3 <italic>In-Vivo</italic> Experiments The control system, in its entirety, has been twice tested on in-vivo canine prostate tissue. Registration results from both tests are similar; the first is presented. The most recent trial of the actual treatment is presented. Handling of animals was in accordance to an Institutional Animal Care and Use Committee approved protocol. General anesthesia was induced, utilizing meditomidine (0.5 mg/kg, intramuscular) and 2% isoflurane was used to maintain general anesthesia. Axial and coronal planning images were acquired using a 1.5T MR scanner (EXCITE HD GE Medical Systems, WI) with a GE 8 4-channel, receive-only phased-array body coil (MRI Devices Corp, Gainesville, FL). Pre-operative axial imaging data of the canine prostate and the neighboring anatomy was used to create a FEM mesh, Figure 11 . The pre-operative imaging data was taken at a resolution of 256×256×36 voxels with a field of view of 240mm×240mm and an out of plane thickness of 3mm with slice spacing of 1.5mm. The FEM mesh consisted of 23,303 dof and 20,064 hexahedral elements. A pipeline of commercial software was used to generate the mesh. AMIRA, www.amiravis.com , was used to perform a semi-automatic segmentation of the prostate and create a faceted surface representation of the prostate. CUBIT, cubit.sandia.gov, was used to convert the faceted surface into a hexahedral mesh and apply boundary conditions. Zero flux ( G = 0 ) boundary conditions are used; heating is not expected to reach the outer boundary of the prostate. Intra-operative axial imaging data is shown in Figure 11 . The intra-operative imaging data was taken at a resolution of 256×256×12 voxels with a field of view of 240mm×240mm and an out of plane spacing of 3mm. Comparison of the pre-operative image and the intra-operative image reveals that the prostate has moved a significant amount which poses a significant registration problem. Current capabilities permit rigid registration only. The rigid registration is based on detecting the outer surface of the canine, not the prostate within. The rigid registration code 4 found the out-of-plane position but failed in-plane due to the prostate movement. Consequently, the mesh was registered manually using AVS for interactive visualization. Furthermore, stringent time constraints on the experiment do not permit the use of the full resolution volume data sets for the rigid registration. The volume data sets must be subsampled to facilitate a reasonable execution time of the serial rigid registration code. However, for rigid registration, subsampling the imaging data by a factor of four in-plane does not lose much information on the outer boundary of the anatomy of the canine and significantly speeds up the registration from approximately twenty-five minutes to roughly two minutes with about 1mm difference in the final result. A planning template was placed on the perineum of the dogs. Coronal images, field of view 20cm×20cm, slice thickness 1.5mm, covering the template and the prostate were input into the template planning program of the Visualase. Three fiducials on the template were identified allowing trajectories to be projected through the prostate volume. A stainless steel stylet was used for inserting the laser catheters, 400 micron core diameter silica fiber in a water-cooled diffused tip catheter, to reach the prostate at a depth of approximately 6cm. The final catheter location was estimated using another set of coronal images. The estimated location of the laser, in DICOM coordinates, was given to HP3d to begin the treatment. A late time treatment image of the control system applied to in-vivo laser treatment of canine prostate is shown in Figure 15 ; the entire duration of the treatment was 18 minutes. As shown, Figure 15 (b) , the goal was to demonstrate that the computational model could control the bioheat transfer and heat a region of 1.2cm in diameter to 60°C. As illustrated in the power history, Figure 15 (e) , the treatment protocol is divided into the four stages described in Figure 4 . During the first stage, the biological domain is pulse heated and MRTI thermal image data is acquired for the heating as well as the cooling. The following parameters were used: field of view = 24 cm, slice thickness = 4 mm, echo train length = 8, acquisition matrix = 256 × 128, repetition time = 545 ms, echo time = 15 ms and flip angle = 60° and five slices were collected per time point. The model calibration is divided into a 180 second data acquisition phase followed by a 180 second computation phase. For the in-vivo experiments, the canine prostate tissue was heated with a 5W pulse for 90 seconds; a 180 second imaging period is used capture the cooling of the in-vivo prostate tissue as well as the heating. The acquired imaging data is used for model calibration computations. The treatment-day thermal imaging data generated for the canine exhibits significant decrease in the signal-to-noise ratio compared to those of the phantom experiments; the positioning grid separated the top coil from the surface of the canine's skin and separated it even further from it's complimentary coil underneath the animal. The use of a calibration pulse of less that 5 W applied power on a previous experiment resulted in minimal heating, suggesting that that the deposited energy was quickly dissipated by blood perfusion and any heating seen was masked by the noise range of the thermal imaging. The treatment imaging data shown in Figure 15 (c) uses a space-time filter; in addition to a spatial median-deriche filtering pipeline, if the thermal data at a pixel changes by more than 11°C it is considered noise and filtered. The 11°C threshold is based on intuition from previous in-vivo experiments. The second stage of the treatment accounts for the time span of the calculations that use the imaging data for model calibration. The third stage accounts for the time delay to recompute the patient-specific optimal temperature/ damage/ HSP heating protocol. The laser is prevented from entering a standby mode through a series of keep-alive pulses during the computational phase. In the fourth and final stage, the optimal laser control parameters are applied to the biological domain. For this particular trial, the perfusion, thermal conductivity, absorption coefficient, and laser position were calibrated. Results of the real-time calibration computations moved the laser tip 5mm from the initial estimated position. Cutlines illustrating the temperature as function of distance are taken through the thermal imaging data and finite element predictions for comparison. The location of the cutline is illustrated in the Anatomy and Thermal Images, Figure 15 (a) . The bottom right cutline, Figure 15 (f) , shows good agreement between the desired treatment plan, the computation prediction, and the experimentally measured MRTI temperature field. A drift in the temperature imaging on the order of -1.7°C was seen over the course the 18min treatment time; implying that the thermal image value may be slighty higher than shown. However, the drift at the beginning of the treatment was insignificant during the 90 second thermal image acquisition for the calibration. The prostate was excised immediately after exsanguination. It was fixed in formalin for 4 days, and then sectioned with guidance of the MR slice locations; this provided pathology slices which were congruent to the post-treatment MR images for comparison, Figure 12 . The damage region was within the targeted 1.2cm diameter treatment objective. The actual power history recorded by the Visualase for the two experiments is shown in Figure 13 . The actual and predicted history are seen to be in very good agreement. However, the minor time delays seen result in a random single pulse not being physically manifested; but, post-treatment computations show that the delay seen in the power control is of little consequence. The six second 15 Watts spike missing from the Visualase log, Figure 13 (a) , has an insignificant effect on the model predictions. Figure 13 (a) also shows that copying the power control file directly to the mounted Visualase directory interferes with Visualase power log and instantaneously turns the laser off. The problem is a result of the file system architecture. Overwriting by copying the file instantaneously deletes the file which instantaneously turns the power off. The fix is trivial, overwriting the file by moving does not delete the file and simply changes the file pointers, Figure 13 (b) . The sharp rise in power to 9 watts at the end of the time history of the Visualase log file, Figure 13 (a) , is due to a manual override of the laser control during the earlier canine experiment.  4.3 <italic>In-Vivo</italic> Experiments The control system, in its entirety, has been twice tested on in-vivo canine prostate tissue. Registration results from both tests are similar; the first is presented. The most recent trial of the actual treatment is presented. Handling of animals was in accordance to an Institutional Animal Care and Use Committee approved protocol. General anesthesia was induced, utilizing meditomidine (0.5 mg/kg, intramuscular) and 2% isoflurane was used to maintain general anesthesia. Axial and coronal planning images were acquired using a 1.5T MR scanner (EXCITE HD GE Medical Systems, WI) with a GE 8 4-channel, receive-only phased-array body coil (MRI Devices Corp, Gainesville, FL). Pre-operative axial imaging data of the canine prostate and the neighboring anatomy was used to create a FEM mesh, Figure 11 . The pre-operative imaging data was taken at a resolution of 256×256×36 voxels with a field of view of 240mm×240mm and an out of plane thickness of 3mm with slice spacing of 1.5mm. The FEM mesh consisted of 23,303 dof and 20,064 hexahedral elements. A pipeline of commercial software was used to generate the mesh. AMIRA, www.amiravis.com , was used to perform a semi-automatic segmentation of the prostate and create a faceted surface representation of the prostate. CUBIT, cubit.sandia.gov, was used to convert the faceted surface into a hexahedral mesh and apply boundary conditions. Zero flux ( G = 0 ) boundary conditions are used; heating is not expected to reach the outer boundary of the prostate. Intra-operative axial imaging data is shown in Figure 11 . The intra-operative imaging data was taken at a resolution of 256×256×12 voxels with a field of view of 240mm×240mm and an out of plane spacing of 3mm. Comparison of the pre-operative image and the intra-operative image reveals that the prostate has moved a significant amount which poses a significant registration problem. Current capabilities permit rigid registration only. The rigid registration is based on detecting the outer surface of the canine, not the prostate within. The rigid registration code 4 found the out-of-plane position but failed in-plane due to the prostate movement. Consequently, the mesh was registered manually using AVS for interactive visualization. Furthermore, stringent time constraints on the experiment do not permit the use of the full resolution volume data sets for the rigid registration. The volume data sets must be subsampled to facilitate a reasonable execution time of the serial rigid registration code. However, for rigid registration, subsampling the imaging data by a factor of four in-plane does not lose much information on the outer boundary of the anatomy of the canine and significantly speeds up the registration from approximately twenty-five minutes to roughly two minutes with about 1mm difference in the final result. A planning template was placed on the perineum of the dogs. Coronal images, field of view 20cm×20cm, slice thickness 1.5mm, covering the template and the prostate were input into the template planning program of the Visualase. Three fiducials on the template were identified allowing trajectories to be projected through the prostate volume. A stainless steel stylet was used for inserting the laser catheters, 400 micron core diameter silica fiber in a water-cooled diffused tip catheter, to reach the prostate at a depth of approximately 6cm. The final catheter location was estimated using another set of coronal images. The estimated location of the laser, in DICOM coordinates, was given to HP3d to begin the treatment. A late time treatment image of the control system applied to in-vivo laser treatment of canine prostate is shown in Figure 15 ; the entire duration of the treatment was 18 minutes. As shown, Figure 15 (b) , the goal was to demonstrate that the computational model could control the bioheat transfer and heat a region of 1.2cm in diameter to 60°C. As illustrated in the power history, Figure 15 (e) , the treatment protocol is divided into the four stages described in Figure 4 . During the first stage, the biological domain is pulse heated and MRTI thermal image data is acquired for the heating as well as the cooling. The following parameters were used: field of view = 24 cm, slice thickness = 4 mm, echo train length = 8, acquisition matrix = 256 × 128, repetition time = 545 ms, echo time = 15 ms and flip angle = 60° and five slices were collected per time point. The model calibration is divided into a 180 second data acquisition phase followed by a 180 second computation phase. For the in-vivo experiments, the canine prostate tissue was heated with a 5W pulse for 90 seconds; a 180 second imaging period is used capture the cooling of the in-vivo prostate tissue as well as the heating. The acquired imaging data is used for model calibration computations. The treatment-day thermal imaging data generated for the canine exhibits significant decrease in the signal-to-noise ratio compared to those of the phantom experiments; the positioning grid separated the top coil from the surface of the canine's skin and separated it even further from it's complimentary coil underneath the animal. The use of a calibration pulse of less that 5 W applied power on a previous experiment resulted in minimal heating, suggesting that that the deposited energy was quickly dissipated by blood perfusion and any heating seen was masked by the noise range of the thermal imaging. The treatment imaging data shown in Figure 15 (c) uses a space-time filter; in addition to a spatial median-deriche filtering pipeline, if the thermal data at a pixel changes by more than 11°C it is considered noise and filtered. The 11°C threshold is based on intuition from previous in-vivo experiments. The second stage of the treatment accounts for the time span of the calculations that use the imaging data for model calibration. The third stage accounts for the time delay to recompute the patient-specific optimal temperature/ damage/ HSP heating protocol. The laser is prevented from entering a standby mode through a series of keep-alive pulses during the computational phase. In the fourth and final stage, the optimal laser control parameters are applied to the biological domain. For this particular trial, the perfusion, thermal conductivity, absorption coefficient, and laser position were calibrated. Results of the real-time calibration computations moved the laser tip 5mm from the initial estimated position. Cutlines illustrating the temperature as function of distance are taken through the thermal imaging data and finite element predictions for comparison. The location of the cutline is illustrated in the Anatomy and Thermal Images, Figure 15 (a) . The bottom right cutline, Figure 15 (f) , shows good agreement between the desired treatment plan, the computation prediction, and the experimentally measured MRTI temperature field. A drift in the temperature imaging on the order of -1.7°C was seen over the course the 18min treatment time; implying that the thermal image value may be slighty higher than shown. However, the drift at the beginning of the treatment was insignificant during the 90 second thermal image acquisition for the calibration. The prostate was excised immediately after exsanguination. It was fixed in formalin for 4 days, and then sectioned with guidance of the MR slice locations; this provided pathology slices which were congruent to the post-treatment MR images for comparison, Figure 12 . The damage region was within the targeted 1.2cm diameter treatment objective. The actual power history recorded by the Visualase for the two experiments is shown in Figure 13 . The actual and predicted history are seen to be in very good agreement. However, the minor time delays seen result in a random single pulse not being physically manifested; but, post-treatment computations show that the delay seen in the power control is of little consequence. The six second 15 Watts spike missing from the Visualase log, Figure 13 (a) , has an insignificant effect on the model predictions. Figure 13 (a) also shows that copying the power control file directly to the mounted Visualase directory interferes with Visualase power log and instantaneously turns the laser off. The problem is a result of the file system architecture. Overwriting by copying the file instantaneously deletes the file which instantaneously turns the power off. The fix is trivial, overwriting the file by moving does not delete the file and simply changes the file pointers, Figure 13 (b) . The sharp rise in power to 9 watts at the end of the time history of the Visualase log file, Figure 13 (a) , is due to a manual override of the laser control during the earlier canine experiment.  5 Conclusions and Future Directions We believe that the results reported in this investigation support the proposition that robust simulation methodologies, based on calibrated nonlinear models of bioheat transfer in heterogeneous tissue, can be designed to interact with clinical thermal imaging modalities to provide near-real-time control of laser therapy for prostate cancer. The control system employs what we refer to as a cyberinfrastructure: a computational grid connecting two remote arenas over a high bandwidth network. The imaging and laser treatment arena in Houston manages a MRTI device, a laser source, and relevant hardware and software units; the computational arena in Austin generates and solves a computational model of laser-driven bioheat transfer using parallel computing algorithms and visualization software and hardware to view the discrete system. New inverse analysis and optimization algorithms and software implementations of them are developed and used to control cell damage (cell viability), HSP-expression, and numerical accuracy. We employ a unified adjoint formulation for backward-in-time calculations for these control algorithms. The tact that numerical simulations and physical measurements interact in a feedback control paradigm in near real time qualifies this system as a Dynamic Data Driven Application System. There are many factors that add to the complexity and difficulty in creating this particular DDDAS. The laboratory subjects used in our experimental trials were canines. Movement of the subject on the MRTI device before initiating therapy requires implementation of non-rigid registration algorithms to define the correct computational domain. Calibration of the heat transfer model is essential, and the presence of spatially heterogeneous thermal properties can lead to inverse analysis problems of enormous size. Numerical filtering algorithms are needed to filter noise inherent in the MRTI-generated thermal signatures. Accurate modeling and control of laser power and its correlation with temperature distributions is critical to the successful execution of the control. Clearly, timing of the various events that evolve during laser therapy is very important and requires access to large-scale parallel computing systems. In the trial runs described in this work, distributions of the computational work over 60 to 100 processors proved to be sufficient to reduce time-to-solution of the computer prediction to interval in which all of the control steps (calibration, power control, etc) would be done without affecting the results. But for systems in which multiple calibrations of highly heterogeneous tissue are needed, 1000 or more cpu's may be needed. Algorithms to exploit the full power of forthcoming peta-scale computers are needed to solve the parabolic constrained optimization problems in a fraction of the time of the actual therapy. This will allow treatment protocol design that is able to calibrate and recompute optimal parameters instantaneously. Current work focuses on using an isotropic laser source to provide the heating and MRTI to provide the imaging in a thermal therapy for treating cancer. From a computational point of view, changing the thermal source or imaging modality merely amounts to changing the source term in the governing PDE or adjoint problem, respectively. This technology has the potential to be extended to many areas of thermal treatment, including RF, microwave, ultrasound, and even cryotherapy applicators. Modeling of the current laser source may also be improved by adding the ability for real time Monte Carlo simulations to predict the laser fluence distribution. Several objective functions have been presented in this work that mathematically characterize a desired treatment plan. It may be argued that different objective functions may be used to better represent the desired goal. For example, current damage functions account for only the damage accumulated during heating. Other objective functions may be designed to account for cooling as well as heating. The damage and HSP treatment models also need to be validated in-vivo . Furthermore, different metrics may be explored to provide a better characterization of the distance between the computed and the ideal solutions. Finally, the objective function evaluation and gradient computation have been the workhorse in this project. Adding the functionality for the Hessian computation may enhance the speed and efficiency of the optimization steps for more complex bioheat models involving larger parameter sets and could add the ability to provide the framework for adding uncertainty quantification for the calibrated model parameters. Given the increasing ability of diagnostic radiology to detect diseases earlier and earlier, the impact of minimally invasive approaches to surgery, such as thermal therapy, will play a large role in safely and efficiently treating cancer with minimal impact on the patient. We hope that this work makes a small step toward the time at which computer modeling and simulation interacting with medical technologies can dramatically improve cancer therapies and enhance and prolong the life of cancer patients.  5 Conclusions and Future Directions We believe that the results reported in this investigation support the proposition that robust simulation methodologies, based on calibrated nonlinear models of bioheat transfer in heterogeneous tissue, can be designed to interact with clinical thermal imaging modalities to provide near-real-time control of laser therapy for prostate cancer. The control system employs what we refer to as a cyberinfrastructure: a computational grid connecting two remote arenas over a high bandwidth network. The imaging and laser treatment arena in Houston manages a MRTI device, a laser source, and relevant hardware and software units; the computational arena in Austin generates and solves a computational model of laser-driven bioheat transfer using parallel computing algorithms and visualization software and hardware to view the discrete system. New inverse analysis and optimization algorithms and software implementations of them are developed and used to control cell damage (cell viability), HSP-expression, and numerical accuracy. We employ a unified adjoint formulation for backward-in-time calculations for these control algorithms. The tact that numerical simulations and physical measurements interact in a feedback control paradigm in near real time qualifies this system as a Dynamic Data Driven Application System. There are many factors that add to the complexity and difficulty in creating this particular DDDAS. The laboratory subjects used in our experimental trials were canines. Movement of the subject on the MRTI device before initiating therapy requires implementation of non-rigid registration algorithms to define the correct computational domain. Calibration of the heat transfer model is essential, and the presence of spatially heterogeneous thermal properties can lead to inverse analysis problems of enormous size. Numerical filtering algorithms are needed to filter noise inherent in the MRTI-generated thermal signatures. Accurate modeling and control of laser power and its correlation with temperature distributions is critical to the successful execution of the control. Clearly, timing of the various events that evolve during laser therapy is very important and requires access to large-scale parallel computing systems. In the trial runs described in this work, distributions of the computational work over 60 to 100 processors proved to be sufficient to reduce time-to-solution of the computer prediction to interval in which all of the control steps (calibration, power control, etc) would be done without affecting the results. But for systems in which multiple calibrations of highly heterogeneous tissue are needed, 1000 or more cpu's may be needed. Algorithms to exploit the full power of forthcoming peta-scale computers are needed to solve the parabolic constrained optimization problems in a fraction of the time of the actual therapy. This will allow treatment protocol design that is able to calibrate and recompute optimal parameters instantaneously. Current work focuses on using an isotropic laser source to provide the heating and MRTI to provide the imaging in a thermal therapy for treating cancer. From a computational point of view, changing the thermal source or imaging modality merely amounts to changing the source term in the governing PDE or adjoint problem, respectively. This technology has the potential to be extended to many areas of thermal treatment, including RF, microwave, ultrasound, and even cryotherapy applicators. Modeling of the current laser source may also be improved by adding the ability for real time Monte Carlo simulations to predict the laser fluence distribution. Several objective functions have been presented in this work that mathematically characterize a desired treatment plan. It may be argued that different objective functions may be used to better represent the desired goal. For example, current damage functions account for only the damage accumulated during heating. Other objective functions may be designed to account for cooling as well as heating. The damage and HSP treatment models also need to be validated in-vivo . Furthermore, different metrics may be explored to provide a better characterization of the distance between the computed and the ideal solutions. Finally, the objective function evaluation and gradient computation have been the workhorse in this project. Adding the functionality for the Hessian computation may enhance the speed and efficiency of the optimization steps for more complex bioheat models involving larger parameter sets and could add the ability to provide the framework for adding uncertainty quantification for the calibrated model parameters. Given the increasing ability of diagnostic radiology to detect diseases earlier and earlier, the impact of minimally invasive approaches to surgery, such as thermal therapy, will play a large role in safely and efficiently treating cancer with minimal impact on the patient. We hope that this work makes a small step toward the time at which computer modeling and simulation interacting with medical technologies can dramatically improve cancer therapies and enhance and prolong the life of cancer patients. 